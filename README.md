# æŸè€—é‡‘å±ä»¶æ£€æµ‹æ£€æµ‹ç³»ç»Ÿæºç åˆ†äº«
 # [ä¸€æ¡é¾™æ•™å­¦YOLOV8æ ‡æ³¨å¥½çš„æ•°æ®é›†ä¸€é”®è®­ç»ƒ_70+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[AAAI Association for the Advancement of Artificial Intelligence](https://gitee.com/qunshansj/projects)

é¡¹ç›®æ¥æº[AACV Association for the Advancement of Computer Vision](https://gitee.com/qunmasj/projects)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€å·¥ä¸šåŒ–è¿›ç¨‹çš„åŠ å¿«ï¼Œé‡‘å±ä»¶åœ¨åˆ¶é€ ä¸šä¸­çš„åº”ç”¨æ„ˆå‘å¹¿æ³›ã€‚ç„¶è€Œï¼Œé‡‘å±ä»¶çš„è´¨é‡ç›´æ¥å½±å“åˆ°äº§å“çš„æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œå› æ­¤ï¼ŒåŠæ—¶ã€å‡†ç¡®åœ°æ£€æµ‹é‡‘å±ä»¶çš„è´¨é‡æˆä¸ºäº†åˆ¶é€ ä¸šäºŸå¾…è§£å†³çš„é—®é¢˜ã€‚ä¼ ç»Ÿçš„é‡‘å±ä»¶æ£€æµ‹æ–¹æ³•å¤šä¾èµ–äººå·¥è§†è§‰æ£€æŸ¥ï¼Œè¿™ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”å®¹æ˜“å—åˆ°äººä¸ºå› ç´ çš„å½±å“ï¼Œå¯¼è‡´æ£€æµ‹ç»“æœçš„ä¸ç¨³å®šæ€§å’Œä¸å‡†ç¡®æ€§ã€‚è¿‘å¹´æ¥ï¼Œè®¡ç®—æœºè§†è§‰æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ä¸ºé‡‘å±ä»¶æ£€æµ‹æä¾›äº†æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå°¤å…¶æ˜¯åŸºäºæ·±åº¦å­¦ä¹ çš„ç›®æ ‡æ£€æµ‹ç®—æ³•åœ¨å„ç±»è§†è§‰ä»»åŠ¡ä¸­å±•ç°å‡ºäº†ä¼˜å¼‚çš„æ€§èƒ½ã€‚

YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—ç®—æ³•å› å…¶é«˜æ•ˆçš„å®æ—¶æ£€æµ‹èƒ½åŠ›è€Œå—åˆ°å¹¿æ³›å…³æ³¨ã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç»“åˆäº†å¤šç§å…ˆè¿›çš„æŠ€æœ¯ï¼Œè¿›ä¸€æ­¥æå‡äº†æ£€æµ‹ç²¾åº¦å’Œé€Ÿåº¦ã€‚ç„¶è€Œï¼Œå°½ç®¡YOLOv8åœ¨ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ï¼Œä½†åœ¨ç‰¹å®šé¢†åŸŸçš„åº”ç”¨ï¼Œå¦‚é‡‘å±ä»¶çš„è´¨é‡æ£€æµ‹ï¼Œä»ç„¶é¢ä¸´ä¸€äº›æŒ‘æˆ˜ã€‚ä¾‹å¦‚ï¼Œé‡‘å±ä»¶çš„å¤–è§‚ç‰¹å¾å¯èƒ½å› ç”Ÿäº§å·¥è‰ºã€ææ–™å·®å¼‚ç­‰å› ç´ è€Œæœ‰æ‰€ä¸åŒï¼Œè¿™ä½¿å¾—æ¨¡å‹åœ¨åˆ†ç±»å’Œå®šä½æ—¶å¯èƒ½å‡ºç°è¯¯åˆ¤ã€‚å› æ­¤ï¼Œæ”¹è¿›YOLOv8ä»¥é€‚åº”é‡‘å±ä»¶æ£€æµ‹çš„ç‰¹å®šéœ€æ±‚ï¼Œå…·æœ‰é‡è¦çš„ç ”ç©¶ä»·å€¼å’Œå®é™…æ„ä¹‰ã€‚

æœ¬ç ”ç©¶åŸºäºDeteksi_Metalæ•°æ®é›†ï¼ŒåŒ…å«2195å¼ å›¾åƒï¼Œåˆ†ä¸ºâ€œBad_Metalâ€å’Œâ€œGood_Metalâ€ä¸¤ä¸ªç±»åˆ«ï¼Œæ—¨åœ¨æ„å»ºä¸€ä¸ªé«˜æ•ˆçš„æŸè€—é‡‘å±ä»¶æ£€æµ‹ç³»ç»Ÿã€‚è¯¥æ•°æ®é›†çš„æ„å»ºä¸ºæ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°æä¾›äº†åšå®çš„åŸºç¡€ã€‚é€šè¿‡å¯¹å›¾åƒæ•°æ®çš„æ·±å…¥åˆ†æï¼Œå¯ä»¥è¯†åˆ«å‡ºé‡‘å±ä»¶çš„å¸¸è§ç¼ºé™·ç‰¹å¾ï¼Œä»è€Œä¸ºæ¨¡å‹çš„æ”¹è¿›æä¾›æŒ‡å¯¼ã€‚ç ”ç©¶å°†é‡ç‚¹å…³æ³¨å¦‚ä½•ä¼˜åŒ–YOLOv8çš„ç½‘ç»œç»“æ„å’Œè®­ç»ƒç­–ç•¥ï¼Œä»¥æé«˜å…¶åœ¨é‡‘å±ä»¶æ£€æµ‹ä¸­çš„è¡¨ç°ã€‚

æ­¤å¤–ï¼Œéšç€å·¥ä¸š4.0çš„æ¨è¿›ï¼Œæ™ºèƒ½åˆ¶é€ å’Œè‡ªåŠ¨åŒ–æ£€æµ‹æˆä¸ºæœªæ¥å‘å±•çš„è¶‹åŠ¿ã€‚åŸºäºæ”¹è¿›YOLOv8çš„æŸè€—é‡‘å±ä»¶æ£€æµ‹ç³»ç»Ÿä¸ä»…èƒ½å¤Ÿæé«˜æ£€æµ‹æ•ˆç‡ï¼Œé™ä½äººå·¥æˆæœ¬ï¼Œè¿˜èƒ½ä¸ºä¼ä¸šæä¾›å®æ—¶çš„è´¨é‡ç›‘æ§æ‰‹æ®µï¼Œè¿›è€Œæå‡äº§å“çš„æ•´ä½“è´¨é‡å’Œå¸‚åœºç«äº‰åŠ›ã€‚é€šè¿‡å°†æ·±åº¦å­¦ä¹ æŠ€æœ¯ä¸é‡‘å±ä»¶æ£€æµ‹ç›¸ç»“åˆï¼Œæœ¬ç ”ç©¶æœ‰æœ›æ¨åŠ¨æ™ºèƒ½æ£€æµ‹æŠ€æœ¯åœ¨åˆ¶é€ ä¸šä¸­çš„åº”ç”¨ï¼Œä¿ƒè¿›ä¼ ç»Ÿäº§ä¸šçš„è½¬å‹å‡çº§ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„æŸè€—é‡‘å±ä»¶æ£€æµ‹ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„ç†è®ºæ„ä¹‰ï¼Œè¿˜å…·å¤‡å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚é€šè¿‡å¯¹é‡‘å±ä»¶æ£€æµ‹æŠ€æœ¯çš„æ·±å…¥æ¢ç´¢ï¼Œèƒ½å¤Ÿä¸ºåˆ¶é€ ä¸šæä¾›æ›´ä¸ºé«˜æ•ˆã€å¯é çš„è´¨é‡æ§åˆ¶æ‰‹æ®µï¼Œæ¨åŠ¨è¡Œä¸šçš„æ™ºèƒ½åŒ–å‘å±•ï¼Œæœ€ç»ˆå®ç°æ›´é«˜æ°´å¹³çš„ç”Ÿäº§æ•ˆç‡å’Œäº§å“è´¨é‡ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV1vstAehEsb/)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 2
names: ['Bad_Metal', 'Good_Metal']


##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨ç°ä»£å·¥ä¸šç”Ÿäº§ä¸­ï¼Œé‡‘å±ä»¶çš„è´¨é‡æ£€æµ‹è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨åˆ¶é€ ä¸šä¸­ï¼Œç¡®ä¿äº§å“çš„è´¨é‡ç›´æ¥å…³ç³»åˆ°ä¼ä¸šçš„ç«äº‰åŠ›å’Œå¸‚åœºå£°èª‰ã€‚ä¸ºæ­¤ï¼Œæ„å»ºä¸€ä¸ªé«˜æ•ˆçš„æŸè€—é‡‘å±ä»¶æ£€æµ‹ç³»ç»Ÿæ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚æœ¬ç ”ç©¶é‡‡ç”¨çš„æ•°æ®é›†åä¸ºâ€œDeteksi_Metalâ€ï¼Œè¯¥æ•°æ®é›†ä¸“é—¨ç”¨äºè®­ç»ƒå’Œæ”¹è¿›YOLOv8æ¨¡å‹ï¼Œä»¥å®ç°å¯¹é‡‘å±ä»¶çš„é«˜æ•ˆæ£€æµ‹å’Œåˆ†ç±»ã€‚

â€œDeteksi_Metalâ€æ•°æ®é›†åŒ…å«ä¸¤ç§ä¸»è¦ç±»åˆ«ï¼Œåˆ†åˆ«ä¸ºâ€œBad_Metalâ€å’Œâ€œGood_Metalâ€ã€‚å…¶ä¸­ï¼Œâ€œBad_Metalâ€ä»£è¡¨é‚£äº›å­˜åœ¨ç¼ºé™·æˆ–æŸè€—çš„é‡‘å±ä»¶ï¼Œè¿™äº›ç¼ºé™·å¯èƒ½åŒ…æ‹¬è¡¨é¢åˆ’ç—•ã€å‡¹é™·ã€é”ˆèš€ç­‰ï¼Œå½±å“é‡‘å±ä»¶çš„ä½¿ç”¨æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚è€Œâ€œGood_Metalâ€åˆ™æŒ‡çš„æ˜¯ç¬¦åˆè´¨é‡æ ‡å‡†çš„é‡‘å±ä»¶ï¼Œè¡¨é¢å…‰æ»‘ã€æ— æ˜æ˜¾ç¼ºé™·ï¼Œèƒ½å¤Ÿæ»¡è¶³å·¥ä¸šç”Ÿäº§çš„è¦æ±‚ã€‚è¿™ç§æ˜ç¡®çš„åˆ†ç±»ä¸ä»…ä¸ºæ¨¡å‹çš„è®­ç»ƒæä¾›äº†æ¸…æ™°çš„ç›®æ ‡ï¼Œä¹Ÿä¸ºåç»­çš„æ£€æµ‹å’Œè´¨é‡æ§åˆ¶æä¾›äº†å¯é çš„ä¾æ®ã€‚

æ•°æ®é›†çš„æ„å»ºè¿‡ç¨‹ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œç¡®ä¿äº†æ ·æœ¬çš„å¤šæ ·æ€§å’Œä»£è¡¨æ€§ã€‚æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬å‡ç»è¿‡ä¸¥æ ¼ç­›é€‰ï¼Œä»¥ä¿è¯å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„æœ‰æ•ˆæ€§å’Œå‡†ç¡®æ€§ã€‚é€šè¿‡æ”¶é›†æ¥è‡ªä¸åŒç”Ÿäº§çº¿ã€ä¸åŒæ‰¹æ¬¡çš„é‡‘å±ä»¶å›¾åƒï¼Œæ•°æ®é›†æ¶µç›–äº†å¤šç§ç¯å¢ƒå’Œå…‰ç…§æ¡ä»¶ä¸‹çš„å›¾åƒæ•°æ®ã€‚è¿™ç§å¤šæ ·æ€§ä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿå­¦ä¹ åˆ°æ›´ä¸ºä¸°å¯Œçš„ç‰¹å¾ï¼Œä»è€Œæé«˜å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„é²æ£’æ€§å’Œå‡†ç¡®æ€§ã€‚

åœ¨æ•°æ®é›†çš„æ ‡æ³¨è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨äº†å…ˆè¿›çš„æ ‡æ³¨å·¥å…·ï¼Œç¡®ä¿æ¯ä¸ªå›¾åƒä¸­çš„é‡‘å±ä»¶éƒ½å¾—åˆ°äº†å‡†ç¡®çš„æ ‡è®°ã€‚æ ‡æ³¨ä¸ä»…åŒ…æ‹¬ç±»åˆ«ä¿¡æ¯ï¼Œè¿˜æ¶µç›–äº†é‡‘å±ä»¶çš„å…·ä½“ä½ç½®å’Œå½¢çŠ¶ç‰¹å¾ï¼Œè¿™ä¸ºåç»­çš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡æä¾›äº†é‡è¦çš„æ”¯æŒã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒYOLOv8æ¨¡å‹èƒ½å¤Ÿåœ¨è®­ç»ƒæ—¶å……åˆ†åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œæå‡å…¶å¯¹é‡‘å±ä»¶çš„æ£€æµ‹èƒ½åŠ›ã€‚

ä¸ºäº†éªŒè¯â€œDeteksi_Metalâ€æ•°æ®é›†çš„æœ‰æ•ˆæ€§ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ªå®éªŒä¸­å¯¹æ¯”äº†ä½¿ç”¨è¯¥æ•°æ®é›†è®­ç»ƒçš„YOLOv8æ¨¡å‹ä¸å…¶ä»–æ¨¡å‹çš„æ€§èƒ½ã€‚å®éªŒç»“æœè¡¨æ˜ï¼ŒåŸºäºâ€œDeteksi_Metalâ€æ•°æ®é›†è®­ç»ƒçš„æ¨¡å‹åœ¨æ£€æµ‹ç²¾åº¦å’Œå¬å›ç‡ä¸Šå‡è¡¨ç°å‡ºè‰²ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†â€œBad_Metalâ€ç±»åˆ«æ—¶ï¼Œæ¨¡å‹èƒ½å¤Ÿæœ‰æ•ˆè¯†åˆ«å‡ºå¤šç§ç±»å‹çš„ç¼ºé™·ã€‚è¿™ä¸€æˆæœä¸ä»…ä¸ºé‡‘å±ä»¶çš„è´¨é‡æ£€æµ‹æä¾›äº†æ–°çš„æ€è·¯ï¼Œä¹Ÿä¸ºç›¸å…³é¢†åŸŸçš„ç ”ç©¶æä¾›äº†å®è´µçš„æ•°æ®æ”¯æŒã€‚

æ€»ä¹‹ï¼Œâ€œDeteksi_Metalâ€æ•°æ®é›†çš„æ„å»ºå’Œåº”ç”¨ä¸ºæŸè€—é‡‘å±ä»¶çš„æ£€æµ‹æä¾›äº†å¼ºæœ‰åŠ›çš„å·¥å…·ï¼Œæ¨åŠ¨äº†YOLOv8æ¨¡å‹åœ¨å·¥ä¸šæ£€æµ‹é¢†åŸŸçš„åº”ç”¨è¿›ç¨‹ã€‚é€šè¿‡ä¸æ–­ä¼˜åŒ–å’Œæ”¹è¿›è¯¥æ•°æ®é›†ï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿè¿›ä¸€æ­¥æå‡é‡‘å±ä»¶æ£€æµ‹ç³»ç»Ÿçš„æ€§èƒ½ï¼Œä¸ºåˆ¶é€ ä¸šçš„æ™ºèƒ½åŒ–å‘å±•è´¡çŒ®åŠ›é‡ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404473917358506534?logTag=c807d0cbc21c0ef59de5)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404474678003106304?logTag=1f1041108cd1f708b01a)

### 6.æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.ixigua.com/7404477157818401292?logTag=d31a2dfd1983c9668658)

### 7.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.ixigua.com/7404478314661806627?logTag=29066f8288e3f4eea3a4)

### 8.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV10ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[8.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.åŸå§‹YOLOV8ç®—æ³•åŸç†

åŸå§‹YOLOv8ç®—æ³•åŸç†

YOLOv8æ˜¯2023å¹´1æœˆ10æ—¥æ¨å‡ºçš„æœ€æ–°ä¸€ä»£ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œæ ‡å¿—ç€YOLOç³»åˆ—çš„åˆä¸€æ¬¡é‡å¤§è¿›æ­¥ã€‚ä½œä¸ºè®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­ç”¨äºåˆ†ç±»ã€æ£€æµ‹å’Œåˆ†å‰²ä»»åŠ¡çš„æœ€å…ˆè¿›æ¨¡å‹ï¼ŒYOLOv8åœ¨ç²¾åº¦å’Œæ‰§è¡Œæ—¶é—´æ–¹é¢éƒ½è¶…è¶Šäº†æ‰€æœ‰å·²çŸ¥çš„æ¨¡å‹ï¼Œå±•ç°å‡ºå…¶åœ¨å®æ—¶ç›®æ ‡æ£€æµ‹ä¸­çš„å“è¶Šæ€§èƒ½ã€‚YOLOv8ä¸ä»…å€Ÿé‰´äº†YOLOv5ã€YOLOv6å’ŒYOLOXç­‰å‰è¾ˆæ¨¡å‹çš„è®¾è®¡ä¼˜ç‚¹ï¼Œè¿˜åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†å…¨é¢çš„ç»“æ„æ”¹è¿›ï¼Œä¿æŒäº†YOLOv5åœ¨å·¥ç¨‹åŒ–æ–¹é¢çš„ç®€æ´æ˜“ç”¨æ€§ï¼ŒåŒæ—¶åœ¨åŠŸèƒ½å’Œæ€§èƒ½ä¸Šè¿›è¡Œäº†æ˜¾è‘—æå‡ã€‚

YOLOv8çš„æ ¸å¿ƒåˆ›æ–°åœ¨äºå…¶å…¨æ–°çš„éª¨å¹²ç½‘ç»œã€Anchor-Freeæ£€æµ‹å¤´å’Œæ”¹è¿›çš„æŸå¤±å‡½æ•°ã€‚è¿™äº›åˆ›æ–°ä½¿å¾—YOLOv8èƒ½å¤Ÿåœ¨å„ç§ç¡¬ä»¶å¹³å°ä¸Šé«˜æ•ˆè¿è¡Œï¼Œä»CPUåˆ°GPUéƒ½èƒ½å®ç°ä¼˜å¼‚çš„æ€§èƒ½ã€‚é¦–å…ˆï¼ŒYOLOv8å°†ç¬¬ä¸€ä¸ªå·ç§¯å±‚çš„å·ç§¯æ ¸ä»6x6ç¼©å°è‡³3x3ï¼Œè¿™ä¸€å˜åŒ–æœ‰æ•ˆæé«˜äº†æ¨¡å‹çš„è®¡ç®—æ•ˆç‡ã€‚å…¶æ¬¡ï¼ŒYOLOv8åœ¨éª¨å¹²ç½‘ç»œä¸­å°†C3æ¨¡å—æ›¿æ¢ä¸ºC2fæ¨¡å—ï¼ŒC2fæ¨¡å—é€šè¿‡å¢åŠ æ›´å¤šçš„è·³å±‚è¿æ¥å’ŒSplitæ“ä½œï¼Œå¢å¼ºäº†ç‰¹å¾çš„æå–èƒ½åŠ›ï¼Œå‡å°‘äº†Neckæ¨¡å—ä¸­çš„å·ç§¯è¿æ¥å±‚ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨¡å‹çš„æ€§èƒ½ã€‚

åœ¨ç‰¹å¾èåˆæ–¹é¢ï¼ŒYOLOv8é‡‡ç”¨äº†PAN-FPNç»“æ„ï¼Œç»“åˆäº†ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œå’Œè·¯å¾„èšåˆç½‘ç»œçš„ä¼˜ç‚¹ï¼Œä½¿å¾—ä¸åŒå°ºåº¦çš„ç‰¹å¾ä¿¡æ¯èƒ½å¤Ÿå¾—åˆ°å……åˆ†èåˆã€‚ç‰¹å¾èåˆå±‚çš„è®¾è®¡ç¡®ä¿äº†æµ…å±‚ç‰¹å¾å’Œé«˜å±‚ç‰¹å¾ä¹‹é—´çš„æœ‰æ•ˆä¿¡æ¯ä¼ é€’ï¼Œä»è€Œæé«˜äº†å¯¹å°ç›®æ ‡å’Œé«˜åˆ†è¾¨ç‡å›¾åƒçš„æ£€æµ‹èƒ½åŠ›ã€‚é€šè¿‡å¯¹YOLOv5ä¸Šé‡‡æ ·é˜¶æ®µçš„ä¼˜åŒ–ï¼ŒYOLOv8èƒ½å¤Ÿåœ¨ä¿æŒé«˜ç²¾åº¦çš„åŒæ—¶ï¼Œæ˜¾è‘—æé«˜æ£€æµ‹é€Ÿåº¦ã€‚

YOLOv8çš„æ£€æµ‹å¤´éƒ¨åˆ†ç»å†äº†æ˜¾è‘—çš„å˜åŒ–ï¼ŒåŸå…ˆçš„è€¦åˆå¤´è¢«è§£è€¦å¤´æ‰€å–ä»£ï¼Œé‡‡ç”¨äº†Anchor-Freeçš„æ£€æµ‹ç­–ç•¥ã€‚è¿™ä¸€ç­–ç•¥çš„å®æ–½ä¸ä»…ç®€åŒ–äº†æ¨¡å‹çš„ç»“æ„ï¼Œè¿˜æé«˜äº†ç›®æ ‡æ£€æµ‹çš„çµæ´»æ€§ã€‚YOLOv8çš„è§£è€¦å¤´å°†åˆ†ç±»å’Œå›å½’ä»»åŠ¡åˆ†å¼€å¤„ç†ï¼Œåˆ†åˆ«è¾“å‡ºç›®æ ‡çš„ç±»åˆ«å’Œè¾¹ç•Œæ¡†ä¿¡æ¯ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨¡å‹çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚æ­¤å¤–ï¼ŒYOLOv8åœ¨æŸå¤±å‡½æ•°çš„è®¾è®¡ä¸Šä¹Ÿè¿›è¡Œäº†åˆ›æ–°ï¼Œé‡‡ç”¨äº†VFLLossä½œä¸ºåˆ†ç±»æŸå¤±ï¼Œå¹¶ç»“åˆDFLLosså’ŒCIoULossè¿›è¡Œè¾¹ç•Œæ¡†å›å½’ï¼Œç¡®ä¿äº†æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„ç¨³å®šæ€§å’Œæ”¶æ•›é€Ÿåº¦ã€‚

åœ¨æ ·æœ¬åŒ¹é…ç­–ç•¥ä¸Šï¼ŒYOLOv8ä»é™æ€åŒ¹é…è½¬å˜ä¸ºTask-Alignedçš„AssigneråŒ¹é…æ–¹å¼ï¼Œä½¿å¾—æ¨¡å‹åœ¨å¤„ç†ä¸åŒä»»åŠ¡æ—¶èƒ½å¤Ÿæ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒYOLOv8èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ä¸åŒç±»å‹çš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡ï¼Œè¿›ä¸€æ­¥æå‡äº†å…¶åº”ç”¨èŒƒå›´å’Œå®ç”¨æ€§ã€‚

YOLOv8çš„è®¾è®¡ç†å¿µå¼ºè°ƒè½»é‡åŒ–å’Œé«˜æ•ˆæ€§ã€‚å…¶è½»é‡åŒ–ç‰ˆæœ¬YOLOv8nåœ¨éª¨å¹²ç‰¹å¾æå–ç½‘ç»œå±‚ä½¿ç”¨äº†æ›´è½»é‡åŒ–çš„C2Fæ¨¡å—ï¼Œæ›¿ä»£äº†åŸæœ‰çš„C3æ¨¡å—ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†æ¨¡å‹çš„è®¡ç®—é‡ã€‚ç‰¹å¾èåˆå±‚çš„è®¾è®¡ä¹Ÿè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå‡å°‘äº†é™é‡‡æ ·å±‚çš„æ•°é‡ï¼Œä½¿å¾—æ¨¡å‹åœ¨ä¿æŒé«˜ç²¾åº¦çš„åŒæ—¶ï¼Œèƒ½å¤Ÿå®ç°æ›´å¿«çš„æ¨ç†é€Ÿåº¦ã€‚è¿™ç§è½»é‡åŒ–çš„è®¾è®¡ä½¿å¾—YOLOv8èƒ½å¤Ÿåœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­ä¾ç„¶ä¿æŒå‡ºè‰²çš„æ€§èƒ½ï¼Œé€‚ç”¨äºå„ç§å®é™…åº”ç”¨åœºæ™¯ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒYOLOv8å±•ç°å‡ºäº†å¼ºå¤§çš„ç›®æ ‡æ£€æµ‹èƒ½åŠ›ï¼Œå°¤å…¶æ˜¯åœ¨å°ç›®æ ‡æ£€æµ‹å’Œé«˜åˆ†è¾¨ç‡å›¾åƒå¤„ç†æ–¹é¢ã€‚é€šè¿‡å¯¹ç‰¹å¾æå–å’Œèåˆçš„ä¼˜åŒ–ï¼ŒYOLOv8èƒ½å¤Ÿæœ‰æ•ˆè¯†åˆ«å›¾åƒä¸­çš„ç»†å°ç›®æ ‡ï¼Œå¹¶åœ¨å¤æ‚èƒŒæ™¯ä¸‹ä¿æŒé«˜å‡†ç¡®ç‡ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—YOLOv8åœ¨æ™ºèƒ½ç›‘æ§ã€è‡ªåŠ¨é©¾é©¶ã€æ— äººæœºå›¾åƒåˆ†æç­‰é¢†åŸŸå…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒYOLOv8ä½œä¸ºYOLOç³»åˆ—çš„æœ€æ–°æˆå‘˜ï¼Œé€šè¿‡ä¸€ç³»åˆ—åˆ›æ–°å’Œæ”¹è¿›ï¼Œä¸ä»…åœ¨ç²¾åº¦å’Œé€Ÿåº¦ä¸Šå®ç°äº†æ˜¾è‘—æå‡ï¼Œè¿˜åœ¨ç»“æ„è®¾è®¡ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½¿å¾—æ¨¡å‹æ›´åŠ è½»é‡åŒ–å’Œé«˜æ•ˆã€‚å…¶åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸçš„è¡¨ç°æ— ç–‘ä¸ºè®¡ç®—æœºè§†è§‰æŠ€æœ¯çš„å‘å±•æ³¨å…¥äº†æ–°çš„æ´»åŠ›ï¼Œæ¨åŠ¨äº†ç›¸å…³åº”ç”¨çš„è¿›æ­¥ã€‚éšç€YOLOv8çš„æ¨å¹¿å’Œåº”ç”¨ï¼Œæœªæ¥çš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡å°†æ›´åŠ é«˜æ•ˆå’Œæ™ºèƒ½ï¼Œå¼€å¯äº†è®¡ç®—æœºè§†è§‰çš„æ–°ç¯‡ç« ã€‚

![18.png](18.png)

### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 code\ultralytics\utils\tal.py

ä»¥ä¸‹æ˜¯å¯¹ç»™å®šä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œæç‚¼å’Œè¯¦ç»†æ³¨é‡Šçš„ç»“æœï¼š

```python
import torch
import torch.nn as nn

class TaskAlignedAssigner(nn.Module):
    """
    ä»»åŠ¡å¯¹é½åˆ†é…å™¨ï¼Œç”¨äºç›®æ ‡æ£€æµ‹ã€‚

    è¯¥ç±»æ ¹æ®ä»»åŠ¡å¯¹é½åº¦é‡å°†çœŸå®å¯¹è±¡ï¼ˆground-truthï¼‰åˆ†é…ç»™é”šç‚¹ï¼Œè¯¥åº¦é‡ç»“åˆäº†åˆ†ç±»å’Œå®šä½ä¿¡æ¯ã€‚

    å±æ€§:
        topk (int): è€ƒè™‘çš„å‰kä¸ªå€™é€‰è€…æ•°é‡ã€‚
        num_classes (int): ç›®æ ‡ç±»åˆ«æ•°é‡ã€‚
        alpha (float): åˆ†ç±»ç»„ä»¶çš„alphaå‚æ•°ã€‚
        beta (float): å®šä½ç»„ä»¶çš„betaå‚æ•°ã€‚
        eps (float): é˜²æ­¢é™¤ä»¥é›¶çš„å°å€¼ã€‚
    """

    def __init__(self, topk=13, num_classes=80, alpha=1.0, beta=6.0, eps=1e-9):
        """åˆå§‹åŒ–ä»»åŠ¡å¯¹é½åˆ†é…å™¨å¯¹è±¡ï¼Œå…è®¸è‡ªå®šä¹‰è¶…å‚æ•°ã€‚"""
        super().__init__()
        self.topk = topk
        self.num_classes = num_classes
        self.bg_idx = num_classes  # èƒŒæ™¯ç±»åˆ«ç´¢å¼•
        self.alpha = alpha
        self.beta = beta
        self.eps = eps

    @torch.no_grad()
    def forward(self, pd_scores, pd_bboxes, anc_points, gt_labels, gt_bboxes, mask_gt):
        """
        è®¡ç®—ä»»åŠ¡å¯¹é½åˆ†é…ã€‚

        å‚æ•°:
            pd_scores (Tensor): é¢„æµ‹åˆ†æ•°ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors, num_classes)
            pd_bboxes (Tensor): é¢„æµ‹è¾¹ç•Œæ¡†ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors, 4)
            anc_points (Tensor): é”šç‚¹åæ ‡ï¼Œå½¢çŠ¶ä¸º(num_total_anchors, 2)
            gt_labels (Tensor): çœŸå®æ ‡ç­¾ï¼Œå½¢çŠ¶ä¸º(bs, n_max_boxes, 1)
            gt_bboxes (Tensor): çœŸå®è¾¹ç•Œæ¡†ï¼Œå½¢çŠ¶ä¸º(bs, n_max_boxes, 4)
            mask_gt (Tensor): çœŸå®ç›®æ ‡æ©ç ï¼Œå½¢çŠ¶ä¸º(bs, n_max_boxes, 1)

        è¿”å›:
            target_labels (Tensor): ç›®æ ‡æ ‡ç­¾ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors)
            target_bboxes (Tensor): ç›®æ ‡è¾¹ç•Œæ¡†ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors, 4)
            target_scores (Tensor): ç›®æ ‡åˆ†æ•°ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors, num_classes)
            fg_mask (Tensor): å‰æ™¯æ©ç ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors)
            target_gt_idx (Tensor): ç›®æ ‡çœŸå®ç´¢å¼•ï¼Œå½¢çŠ¶ä¸º(bs, num_total_anchors)
        """
        self.bs = pd_scores.size(0)  # æ‰¹é‡å¤§å°
        self.n_max_boxes = gt_bboxes.size(1)  # æœ€å¤§ç›®æ ‡æ•°é‡

        # å¦‚æœæ²¡æœ‰çœŸå®ç›®æ ‡ï¼Œè¿”å›èƒŒæ™¯ç´¢å¼•å’Œé›¶å¼ é‡
        if self.n_max_boxes == 0:
            device = gt_bboxes.device
            return (
                torch.full_like(pd_scores[..., 0], self.bg_idx).to(device),
                torch.zeros_like(pd_bboxes).to(device),
                torch.zeros_like(pd_scores).to(device),
                torch.zeros_like(pd_scores[..., 0]).to(device),
                torch.zeros_like(pd_scores[..., 0]).to(device),
            )

        # è·å–æ­£æ ·æœ¬æ©ç ã€å¯¹é½åº¦é‡å’Œé‡å åº¦
        mask_pos, align_metric, overlaps = self.get_pos_mask(
            pd_scores, pd_bboxes, gt_labels, gt_bboxes, anc_points, mask_gt
        )

        # é€‰æ‹©é‡å åº¦æœ€é«˜çš„ç›®æ ‡
        target_gt_idx, fg_mask, mask_pos = self.select_highest_overlaps(mask_pos, overlaps, self.n_max_boxes)

        # è·å–ç›®æ ‡æ ‡ç­¾ã€è¾¹ç•Œæ¡†å’Œåˆ†æ•°
        target_labels, target_bboxes, target_scores = self.get_targets(gt_labels, gt_bboxes, target_gt_idx, fg_mask)

        # å½’ä¸€åŒ–å¯¹é½åº¦é‡
        align_metric *= mask_pos
        pos_align_metrics = align_metric.amax(dim=-1, keepdim=True)  # b, max_num_obj
        pos_overlaps = (overlaps * mask_pos).amax(dim=-1, keepdim=True)  # b, max_num_obj
        norm_align_metric = (align_metric * pos_overlaps / (pos_align_metrics + self.eps)).amax(-2).unsqueeze(-1)
        target_scores = target_scores * norm_align_metric

        return target_labels, target_bboxes, target_scores, fg_mask.bool(), target_gt_idx

    def get_pos_mask(self, pd_scores, pd_bboxes, gt_labels, gt_bboxes, anc_points, mask_gt):
        """è·å–æ­£æ ·æœ¬æ©ç å’Œå¯¹é½åº¦é‡ã€‚"""
        mask_in_gts = self.select_candidates_in_gts(anc_points, gt_bboxes)  # é€‰æ‹©åœ¨çœŸå®ç›®æ ‡ä¸­çš„é”šç‚¹
        align_metric, overlaps = self.get_box_metrics(pd_scores, pd_bboxes, gt_labels, gt_bboxes, mask_in_gts * mask_gt)  # è®¡ç®—å¯¹é½åº¦é‡å’Œé‡å åº¦
        mask_topk = self.select_topk_candidates(align_metric, topk_mask=mask_gt.expand(-1, -1, self.topk).bool())  # é€‰æ‹©å‰kä¸ªå€™é€‰è€…
        mask_pos = mask_topk * mask_in_gts * mask_gt  # åˆå¹¶æ©ç 

        return mask_pos, align_metric, overlaps

    def get_box_metrics(self, pd_scores, pd_bboxes, gt_labels, gt_bboxes, mask_gt):
        """è®¡ç®—é¢„æµ‹è¾¹ç•Œæ¡†ä¸çœŸå®è¾¹ç•Œæ¡†çš„å¯¹é½åº¦é‡ã€‚"""
        na = pd_bboxes.shape[-2]  # é”šç‚¹æ•°é‡
        mask_gt = mask_gt.bool()  # è½¬æ¢ä¸ºå¸ƒå°”ç±»å‹æ©ç 
        overlaps = torch.zeros([self.bs, self.n_max_boxes, na], dtype=pd_bboxes.dtype, device=pd_bboxes.device)  # åˆå§‹åŒ–é‡å åº¦å¼ é‡
        bbox_scores = torch.zeros([self.bs, self.n_max_boxes, na], dtype=pd_scores.dtype, device=pd_scores.device)  # åˆå§‹åŒ–è¾¹ç•Œæ¡†åˆ†æ•°å¼ é‡

        ind = torch.zeros([2, self.bs, self.n_max_boxes], dtype=torch.long)  # è®°å½•ç´¢å¼•
        ind[0] = torch.arange(end=self.bs).view(-1, 1).expand(-1, self.n_max_boxes)  # æ‰¹é‡ç´¢å¼•
        ind[1] = gt_labels.squeeze(-1)  # çœŸå®æ ‡ç­¾ç´¢å¼•
        bbox_scores[mask_gt] = pd_scores[ind[0], :, ind[1]][mask_gt]  # è·å–æ¯ä¸ªçœŸå®ç›®æ ‡çš„åˆ†æ•°

        # è®¡ç®—é‡å åº¦
        pd_boxes = pd_bboxes.unsqueeze(1).expand(-1, self.n_max_boxes, -1, -1)[mask_gt]
        gt_boxes = gt_bboxes.unsqueeze(2).expand(-1, -1, na, -1)[mask_gt]
        overlaps[mask_gt] = self.iou_calculation(gt_boxes, pd_boxes)  # è®¡ç®—IoU

        # è®¡ç®—å¯¹é½åº¦é‡
        align_metric = bbox_scores.pow(self.alpha) * overlaps.pow(self.beta)
        return align_metric, overlaps

    def iou_calculation(self, gt_bboxes, pd_bboxes):
        """è®¡ç®—IoUï¼ˆäº¤å¹¶æ¯”ï¼‰ã€‚"""
        return bbox_iou(gt_bboxes, pd_bboxes, xywh=False, CIoU=True).squeeze(-1).clamp_(0)

    def select_topk_candidates(self, metrics, largest=True, topk_mask=None):
        """æ ¹æ®ç»™å®šçš„åº¦é‡é€‰æ‹©å‰kä¸ªå€™é€‰è€…ã€‚"""
        topk_metrics, topk_idxs = torch.topk(metrics, self.topk, dim=-1, largest=largest)  # è·å–å‰kä¸ªåº¦é‡
        if topk_mask is None:
            topk_mask = (topk_metrics.max(-1, keepdim=True)[0] > self.eps).expand_as(topk_idxs)  # ç”Ÿæˆæ©ç 
        topk_idxs.masked_fill_(~topk_mask, 0)  # ç”¨äºæ— æ•ˆå€¼çš„æ©ç 

        # è®¡ç®—æœ‰æ•ˆçš„å€™é€‰è€…æ•°é‡
        count_tensor = torch.zeros(metrics.shape, dtype=torch.int8, device=topk_idxs.device)
        ones = torch.ones_like(topk_idxs[:, :, :1], dtype=torch.int8, device=topk_idxs.device)
        for k in range(self.topk):
            count_tensor.scatter_add_(-1, topk_idxs[:, :, k : k + 1], ones)  # æ›´æ–°è®¡æ•°
        count_tensor.masked_fill_(count_tensor > 1, 0)  # è¿‡æ»¤æ— æ•ˆè¾¹ç•Œæ¡†

        return count_tensor.to(metrics.dtype)

    def get_targets(self, gt_labels, gt_bboxes, target_gt_idx, fg_mask):
        """è®¡ç®—æ­£æ ·æœ¬çš„ç›®æ ‡æ ‡ç­¾ã€è¾¹ç•Œæ¡†å’Œåˆ†æ•°ã€‚"""
        batch_ind = torch.arange(end=self.bs, dtype=torch.int64, device=gt_labels.device)[..., None]
        target_gt_idx = target_gt_idx + batch_ind * self.n_max_boxes  # æ›´æ–°ç´¢å¼•
        target_labels = gt_labels.long().flatten()[target_gt_idx]  # è·å–ç›®æ ‡æ ‡ç­¾

        target_bboxes = gt_bboxes.view(-1, gt_bboxes.shape[-1])[target_gt_idx]  # è·å–ç›®æ ‡è¾¹ç•Œæ¡†
        target_labels.clamp_(0)  # é™åˆ¶æ ‡ç­¾èŒƒå›´

        # ç”Ÿæˆç›®æ ‡åˆ†æ•°
        target_scores = torch.zeros(
            (target_labels.shape[0], target_labels.shape[1], self.num_classes),
            dtype=torch.int64,
            device=target_labels.device,
        )
        target_scores.scatter_(2, target_labels.unsqueeze(-1), 1)  # ç”Ÿæˆone-hotç¼–ç 

        fg_scores_mask = fg_mask[:, :, None].repeat(1, 1, self.num_classes)  # å‰æ™¯åˆ†æ•°æ©ç 
        target_scores = torch.where(fg_scores_mask > 0, target_scores, 0)  # åº”ç”¨æ©ç 

        return target_labels, target_bboxes, target_scores

    @staticmethod
    def select_candidates_in_gts(xy_centers, gt_bboxes, eps=1e-9):
        """é€‰æ‹©åœ¨çœŸå®ç›®æ ‡ä¸­çš„æ­£æ ·æœ¬é”šç‚¹ã€‚"""
        n_anchors = xy_centers.shape[0]
        bs, n_boxes, _ = gt_bboxes.shape
        lt, rb = gt_bboxes.view(-1, 1, 4).chunk(2, 2)  # è·å–å·¦ä¸Šè§’å’Œå³ä¸‹è§’
        bbox_deltas = torch.cat((xy_centers[None] - lt, rb - xy_centers[None]), dim=2).view(bs, n_boxes, n_anchors, -1)
        return bbox_deltas.amin(3).gt_(eps)  # è¿”å›åœ¨çœŸå®ç›®æ ‡å†…çš„é”šç‚¹

    @staticmethod
    def select_highest_overlaps(mask_pos, overlaps, n_max_boxes):
        """é€‰æ‹©é‡å åº¦æœ€é«˜çš„ç›®æ ‡ã€‚"""
        fg_mask = mask_pos.sum(-2)  # è®¡ç®—å‰æ™¯æ©ç 
        if fg_mask.max() > 1:  # å¦‚æœä¸€ä¸ªé”šç‚¹åˆ†é…ç»™å¤šä¸ªçœŸå®ç›®æ ‡
            mask_multi_gts = (fg_mask.unsqueeze(1) > 1).expand(-1, n_max_boxes, -1)  # ç”Ÿæˆå¤šç›®æ ‡æ©ç 
            max_overlaps_idx = overlaps.argmax(1)  # è·å–æœ€å¤§é‡å åº¦ç´¢å¼•

            is_max_overlaps = torch.zeros(mask_pos.shape, dtype=mask_pos.dtype, device=mask_pos.device)
            is_max_overlaps.scatter_(1, max_overlaps_idx.unsqueeze(1), 1)  # æ ‡è®°æœ€å¤§é‡å åº¦

            mask_pos = torch.where(mask_multi_gts, is_max_overlaps, mask_pos).float()  # æ›´æ–°æ©ç 
            fg_mask = mask_pos.sum(-2)  # æ›´æ–°å‰æ™¯æ©ç 
        target_gt_idx = mask_pos.argmax(-2)  # è·å–ç›®æ ‡ç´¢å¼•
        return target_gt_idx, fg_mask, mask_pos  # è¿”å›ç›®æ ‡ç´¢å¼•ã€å‰æ™¯æ©ç å’Œæ©ç 

# å…¶ä»–è¾…åŠ©å‡½æ•°å’Œç±»å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œç±»ä¼¼çš„æç‚¼å’Œæ³¨é‡Š
```

ä»¥ä¸Šä»£ç ä¿ç•™äº† `TaskAlignedAssigner` ç±»çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè¯¦ç»†æ³¨é‡Šäº†æ¯ä¸ªæ–¹æ³•çš„ä½œç”¨å’Œå‚æ•°è¯´æ˜ã€‚å…¶ä»–è¾…åŠ©å‡½æ•°å’Œç±»çš„æ³¨é‡Šå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œç›¸ä¼¼çš„å¤„ç†ã€‚

è¿™ä¸ªæ–‡ä»¶ `tal.py` æ˜¯ Ultralytics YOLOï¼ˆYou Only Look Onceï¼‰ç›®æ ‡æ£€æµ‹æ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦å®ç°äº†ä¸€ä¸ªä»»åŠ¡å¯¹é½åˆ†é…å™¨ï¼ˆTaskAlignedAssignerï¼‰ï¼Œç”¨äºå°†çœŸå®ç›®æ ‡ï¼ˆground-truthï¼‰ä¸é”šæ¡†ï¼ˆanchorsï¼‰è¿›è¡ŒåŒ¹é…ã€‚è¿™ä¸ªç±»ç»“åˆäº†åˆ†ç±»å’Œå®šä½ä¿¡æ¯ï¼Œé€šè¿‡ä¸€ä¸ªä»»åŠ¡å¯¹é½çš„åº¦é‡æ¥ä¼˜åŒ–ç›®æ ‡æ£€æµ‹çš„æ€§èƒ½ã€‚

åœ¨æ–‡ä»¶çš„å¼€å¤´ï¼Œå¯¼å…¥äº†å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬ PyTorch å’Œä¸€äº›è‡ªå®šä¹‰çš„æ¨¡å—ã€‚æ¥ç€ï¼Œå®šä¹‰äº† `TaskAlignedAssigner` ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ª `nn.Module`ï¼Œå¹¶åœ¨åˆå§‹åŒ–æ—¶è®¾ç½®äº†ä¸€äº›è¶…å‚æ•°ï¼Œå¦‚ `topk`ï¼ˆè€ƒè™‘çš„å€™é€‰æ¡†æ•°é‡ï¼‰ã€`num_classes`ï¼ˆç›®æ ‡ç±»åˆ«æ•°é‡ï¼‰ã€`alpha` å’Œ `beta`ï¼ˆç”¨äºåˆ†ç±»å’Œå®šä½çš„æƒé‡ï¼‰ä»¥åŠ `eps`ï¼ˆé˜²æ­¢é™¤é›¶çš„å¾®å°å€¼ï¼‰ã€‚

`forward` æ–¹æ³•æ˜¯ç±»çš„æ ¸å¿ƒï¼Œæ¥å—é¢„æµ‹çš„åˆ†æ•°ã€è¾¹ç•Œæ¡†ã€é”šç‚¹ã€çœŸå®æ ‡ç­¾å’Œè¾¹ç•Œæ¡†ç­‰è¾“å…¥ï¼Œè®¡ç®—ä»»åŠ¡å¯¹é½çš„åˆ†é…ã€‚å®ƒé¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰çœŸå®ç›®æ ‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›èƒŒæ™¯æ ‡ç­¾å’Œé›¶å€¼çš„è¾¹ç•Œæ¡†å’Œåˆ†æ•°ã€‚æ¥ç€ï¼Œå®ƒè°ƒç”¨ `get_pos_mask` æ–¹æ³•è·å–æ­£æ ·æœ¬çš„æ©ç ã€å¯¹é½åº¦é‡å’Œé‡å åº¦é‡ã€‚ç„¶åï¼Œé€šè¿‡ `select_highest_overlaps` æ–¹æ³•é€‰æ‹©é‡å åº¦æœ€å¤§çš„ç›®æ ‡ï¼Œå¹¶è·å–ç›®æ ‡æ ‡ç­¾ã€è¾¹ç•Œæ¡†å’Œåˆ†æ•°ã€‚æœ€åï¼Œå¯¹å¯¹é½åº¦é‡è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œå¹¶è¿”å›ç›®æ ‡æ ‡ç­¾ã€è¾¹ç•Œæ¡†ã€åˆ†æ•°ã€å‰æ™¯æ©ç å’Œç›®æ ‡ç´¢å¼•ã€‚

`get_pos_mask` æ–¹æ³•ç”¨äºè·å–æ­£æ ·æœ¬çš„æ©ç ï¼Œè®¡ç®—å¯¹é½åº¦é‡å’Œé‡å åº¦é‡ã€‚`get_box_metrics` æ–¹æ³•è®¡ç®—é¢„æµ‹è¾¹ç•Œæ¡†ä¸çœŸå®è¾¹ç•Œæ¡†ä¹‹é—´çš„å¯¹é½åº¦é‡ï¼Œä½¿ç”¨ `iou_calculation` æ–¹æ³•è®¡ç®—äº¤å¹¶æ¯”ï¼ˆIoUï¼‰ã€‚`select_topk_candidates` æ–¹æ³•é€‰æ‹©åŸºäºç»™å®šåº¦é‡çš„å‰ k ä¸ªå€™é€‰æ¡†ã€‚`get_targets` æ–¹æ³•è®¡ç®—æ­£é”šç‚¹çš„ç›®æ ‡æ ‡ç­¾ã€è¾¹ç•Œæ¡†å’Œåˆ†æ•°ã€‚

æ­¤å¤–ï¼Œæ–‡ä»¶ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ª `RotatedTaskAlignedAssigner` ç±»ï¼Œç»§æ‰¿è‡ª `TaskAlignedAssigner`ï¼Œç”¨äºå¤„ç†æ—‹è½¬è¾¹ç•Œæ¡†çš„æƒ…å†µã€‚å®ƒé‡å†™äº† `iou_calculation` æ–¹æ³•ï¼Œä½¿ç”¨æ—‹è½¬çš„ IoU è®¡ç®—æ–¹æ³•ã€‚

æœ€åï¼Œæ–‡ä»¶è¿˜åŒ…å«äº†ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œå¦‚ `make_anchors` ç”¨äºç”Ÿæˆé”šæ¡†ï¼Œ`dist2bbox` å’Œ `bbox2dist` ç”¨äºåœ¨é”šæ¡†å’Œè¾¹ç•Œæ¡†ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œ`dist2rbox` ç”¨äºè§£ç é¢„æµ‹çš„æ—‹è½¬è¾¹ç•Œæ¡†åæ ‡ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ç›®æ ‡æ£€æµ‹ä¸­é”šæ¡†ä¸çœŸå®ç›®æ ‡ä¹‹é—´çš„åŒ¹é…æœºåˆ¶ï¼Œç»“åˆäº†åˆ†ç±»å’Œå®šä½ä¿¡æ¯ï¼Œæ—¨åœ¨æé«˜ç›®æ ‡æ£€æµ‹çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚

#### 11.2 ui.py

ä»¥ä¸‹æ˜¯ä¿ç•™çš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import sys
import subprocess

def run_script(script_path):
    """
    ä½¿ç”¨å½“å‰ Python ç¯å¢ƒè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

    Args:
        script_path (str): è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„

    Returns:
        None
    """
    # è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„
    python_path = sys.executable

    # æ„å»ºè¿è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ streamlit è¿è¡ŒæŒ‡å®šçš„è„šæœ¬
    command = f'"{python_path}" -m streamlit run "{script_path}"'

    # æ‰§è¡Œå‘½ä»¤
    result = subprocess.run(command, shell=True)
    # æ£€æŸ¥å‘½ä»¤æ‰§è¡Œç»“æœï¼Œå¦‚æœè¿”å›ç ä¸ä¸º0ï¼Œè¡¨ç¤ºå‡ºé”™
    if result.returncode != 0:
        print("è„šæœ¬è¿è¡Œå‡ºé”™ã€‚")

# å®ä¾‹åŒ–å¹¶è¿è¡Œåº”ç”¨
if __name__ == "__main__":
    # æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„
    script_path = "web.py"  # å‡è®¾è„šæœ¬åœ¨å½“å‰ç›®å½•ä¸‹

    # è°ƒç”¨å‡½æ•°è¿è¡Œè„šæœ¬
    run_script(script_path)
```

### æ³¨é‡Šè¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼š
   - `sys`ï¼šç”¨äºè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ã€‚
   - `subprocess`ï¼šç”¨äºæ‰§è¡Œå¤–éƒ¨å‘½ä»¤ã€‚

2. **run_script å‡½æ•°**ï¼š
   - è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªè„šæœ¬è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨å½“å‰ Python ç¯å¢ƒä¸­è¿è¡Œè¯¥è„šæœ¬ã€‚
   - ä½¿ç”¨ `sys.executable` è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œä»¥ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ Python ç¯å¢ƒã€‚
   - æ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `streamlit` æ¨¡å—è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚
   - ä½¿ç”¨ `subprocess.run` æ‰§è¡Œæ„å»ºçš„å‘½ä»¤ï¼Œå¹¶æ£€æŸ¥è¿”å›ç ä»¥åˆ¤æ–­è„šæœ¬æ˜¯å¦æˆåŠŸè¿è¡Œã€‚

3. **ä¸»ç¨‹åºå…¥å£**ï¼š
   - ä½¿ç”¨ `if __name__ == "__main__":` ç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥è„šæœ¬æ—¶æ‰ä¼šæ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚
   - æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä¸º `"web.py"`ï¼‰ã€‚
   - è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶åä¸º `ui.py`ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡å½“å‰çš„ Python ç¯å¢ƒè¿è¡Œä¸€ä¸ªæŒ‡å®šçš„è„šæœ¬ã€‚ç¨‹åºé¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬ `sys`ã€`os` å’Œ `subprocess`ï¼Œä»¥åŠä¸€ä¸ªè‡ªå®šä¹‰æ¨¡å— `QtFusion.path` ä¸­çš„ `abs_path` å‡½æ•°ã€‚

åœ¨ç¨‹åºä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º `run_script` çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•° `script_path`ï¼Œä»£è¡¨è¦è¿è¡Œçš„è„šæœ¬çš„è·¯å¾„ã€‚å‡½æ•°å†…éƒ¨é¦–å…ˆè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œè¿™é€šè¿‡ `sys.executable` å®ç°ã€‚æ¥ç€ï¼Œæ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `streamlit` æ¨¡å—æ¥è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚è¿™ä¸ªå‘½ä»¤ä½¿ç”¨äº† Python çš„ `-m` é€‰é¡¹æ¥ç¡®ä¿ `streamlit` ä½œä¸ºæ¨¡å—è¢«æ­£ç¡®è°ƒç”¨ã€‚

ç„¶åï¼Œä½¿ç”¨ `subprocess.run` æ–¹æ³•æ‰§è¡Œæ„å»ºå¥½çš„å‘½ä»¤ã€‚è¯¥æ–¹æ³•çš„ `shell=True` å‚æ•°å…è®¸åœ¨ shell ä¸­æ‰§è¡Œå‘½ä»¤ã€‚æ‰§è¡Œåï¼Œç¨‹åºæ£€æŸ¥è¿”å›çš„ç»“æœç ï¼Œå¦‚æœç»“æœç ä¸ä¸ºé›¶ï¼Œè¡¨ç¤ºè„šæœ¬è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ï¼Œæ­¤æ—¶ä¼šæ‰“å°å‡ºä¸€æ¡é”™è¯¯ä¿¡æ¯ã€‚

åœ¨æ–‡ä»¶çš„æœ€åéƒ¨åˆ†ï¼Œç¨‹åºé€šè¿‡ `if __name__ == "__main__":` è¯­å¥æ¥ç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥æ–‡ä»¶æ—¶æ‰ä¼šæ‰§è¡Œåç»­ä»£ç ã€‚åœ¨è¿™é‡Œï¼ŒæŒ‡å®šäº†è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ä¸º `web.py`ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºçš„ä½œç”¨æ˜¯ç®€åŒ–é€šè¿‡å½“å‰ Python ç¯å¢ƒè¿è¡Œä¸€ä¸ªç‰¹å®šè„šæœ¬çš„è¿‡ç¨‹ï¼Œå¹¶åœ¨è¿è¡Œå‡ºé”™æ—¶æä¾›åé¦ˆã€‚

#### 11.3 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\sam\modules\__init__.py

å½“ç„¶å¯ä»¥ã€‚è™½ç„¶ä½ æä¾›çš„ä»£ç ç‰‡æ®µéå¸¸ç®€çŸ­ï¼Œä»…åŒ…å«ä¸€è¡Œæ³¨é‡Šï¼Œä½†æˆ‘å¯ä»¥ä¸ºä½ æä¾›ä¸€ä¸ªå…³äºUltralytics YOLOçš„æ ¸å¿ƒä»£ç ç»“æ„ç¤ºä¾‹ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„YOLOæ¨¡å‹ä»£ç ç¤ºä¾‹ï¼š

```python
import torch  # å¯¼å…¥PyTorchåº“

class YOLOv5:  # å®šä¹‰YOLOv5ç±»
    def __init__(self, model_path):  # åˆå§‹åŒ–æ–¹æ³•ï¼Œæ¥æ”¶æ¨¡å‹è·¯å¾„
        self.model = torch.load(model_path)  # åŠ è½½é¢„è®­ç»ƒæ¨¡å‹

    def predict(self, image):  # å®šä¹‰é¢„æµ‹æ–¹æ³•ï¼Œæ¥æ”¶è¾“å…¥å›¾åƒ
        results = self.model(image)  # ä½¿ç”¨æ¨¡å‹å¯¹å›¾åƒè¿›è¡Œæ¨ç†
        return results  # è¿”å›æ¨ç†ç»“æœ

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":  # å¦‚æœæ˜¯ä¸»ç¨‹åº
    yolo = YOLOv5('yolov5s.pt')  # åˆ›å»ºYOLOv5å¯¹è±¡ï¼ŒåŠ è½½æ¨¡å‹
    img = torch.zeros((1, 3, 640, 640))  # åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿå›¾åƒï¼ˆå¼ é‡ï¼‰
    predictions = yolo.predict(img)  # å¯¹è™šæ‹Ÿå›¾åƒè¿›è¡Œé¢„æµ‹
    print(predictions)  # æ‰“å°é¢„æµ‹ç»“æœ
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š

1. **å¯¼å…¥åº“**ï¼š
   - `import torch`ï¼šå¯¼å…¥PyTorchåº“ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºæ·±åº¦å­¦ä¹ çš„æµè¡Œæ¡†æ¶ã€‚

2. **YOLOv5ç±»**ï¼š
   - `class YOLOv5:`ï¼šå®šä¹‰ä¸€ä¸ªåä¸º`YOLOv5`çš„ç±»ï¼Œç”¨äºå°è£…YOLOv5æ¨¡å‹çš„åŠŸèƒ½ã€‚

3. **åˆå§‹åŒ–æ–¹æ³•**ï¼š
   - `def __init__(self, model_path):`ï¼šæ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°`model_path`ï¼Œç”¨äºæŒ‡å®šæ¨¡å‹æ–‡ä»¶çš„è·¯å¾„ã€‚
   - `self.model = torch.load(model_path)`ï¼šä½¿ç”¨`torch.load`æ–¹æ³•åŠ è½½æŒ‡å®šè·¯å¾„çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å®ä¾‹å˜é‡`self.model`ä¸­ã€‚

4. **é¢„æµ‹æ–¹æ³•**ï¼š
   - `def predict(self, image):`ï¼šå®šä¹‰ä¸€ä¸ªåä¸º`predict`çš„æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°`image`ï¼Œè¡¨ç¤ºè¾“å…¥çš„å›¾åƒã€‚
   - `results = self.model(image)`ï¼šè°ƒç”¨åŠ è½½çš„æ¨¡å‹å¯¹è¾“å…¥å›¾åƒè¿›è¡Œæ¨ç†ï¼Œå¾—åˆ°é¢„æµ‹ç»“æœã€‚
   - `return results`ï¼šè¿”å›é¢„æµ‹ç»“æœã€‚

5. **ä½¿ç”¨ç¤ºä¾‹**ï¼š
   - `if __name__ == "__main__":`ï¼šæ£€æŸ¥å½“å‰æ¨¡å—æ˜¯å¦æ˜¯ä¸»ç¨‹åºï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚
   - `yolo = YOLOv5('yolov5s.pt')`ï¼šåˆ›å»º`YOLOv5`ç±»çš„å®ä¾‹ï¼Œå¹¶åŠ è½½åä¸º'yolov5s.pt'çš„æ¨¡å‹ã€‚
   - `img = torch.zeros((1, 3, 640, 640))`ï¼šåˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º(1, 3, 640, 640)çš„è™šæ‹Ÿå›¾åƒå¼ é‡ï¼Œè¡¨ç¤ºä¸€å¼ 640x640çš„RGBå›¾åƒã€‚
   - `predictions = yolo.predict(img)`ï¼šè°ƒç”¨`predict`æ–¹æ³•å¯¹è™šæ‹Ÿå›¾åƒè¿›è¡Œé¢„æµ‹ã€‚
   - `print(predictions)`ï¼šæ‰“å°é¢„æµ‹ç»“æœã€‚

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†YOLOv5æ¨¡å‹çš„åŸºæœ¬ç»“æ„å’Œä½¿ç”¨æ–¹æ³•ï¼Œæ³¨é‡Šè¯¦ç»†è§£é‡Šäº†æ¯ä¸€éƒ¨åˆ†çš„åŠŸèƒ½ã€‚

è¿™ä¸ªæ–‡ä»¶æ˜¯Ultralytics YOLOé¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦æ¶‰åŠYOLOv8ç®—æ³•çš„å®ç°å’Œç›¸å…³æ¨¡å—çš„åˆå§‹åŒ–ã€‚æ–‡ä»¶å¼€å¤´çš„æ³¨é‡Šéƒ¨åˆ†æåˆ°è¯¥é¡¹ç›®éµå¾ªAGPL-3.0è®¸å¯è¯ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘è¯¥ä»£ç ï¼Œä½†å¿…é¡»åœ¨ç›¸åŒè®¸å¯è¯ä¸‹å…±äº«è¡ç”Ÿä½œå“ã€‚

åœ¨è¿™ä¸ªç‰¹å®šçš„`__init__.py`æ–‡ä»¶ä¸­ï¼Œé€šå¸¸ä¼šåŒ…å«æ¨¡å—çš„åˆå§‹åŒ–ä»£ç ï¼Œä½¿å¾—è¯¥ç›®å½•å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªåŒ…ã€‚åœ¨Pythonä¸­ï¼Œ`__init__.py`æ–‡ä»¶çš„å­˜åœ¨ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¯¼å…¥è¯¥ç›®å½•ä¸‹çš„å…¶ä»–æ¨¡å—å’ŒåŠŸèƒ½ã€‚

è™½ç„¶å…·ä½“çš„ä»£ç å†…å®¹æ²¡æœ‰æä¾›ï¼Œä½†é€šå¸¸åœ¨è¿™æ ·çš„æ–‡ä»¶ä¸­ï¼Œå¯èƒ½ä¼šåŒ…å«ä¸€äº›å¿…è¦çš„å¯¼å…¥è¯­å¥ã€åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ã€ä½œè€…ä¿¡æ¯ä»¥åŠå…¶ä»–ç›¸å…³çš„åˆå§‹åŒ–é€»è¾‘ã€‚è¿™äº›å†…å®¹å¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨YOLOv8ç®—æ³•ï¼ŒåŒæ—¶ä¹Ÿä¸ºåç»­çš„æ¨¡å—æä¾›å¿…è¦çš„æ”¯æŒã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯YOLOv8é¡¹ç›®çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè´Ÿè´£æ¨¡å—çš„åˆå§‹åŒ–å’ŒåŒ…çš„ç»“æ„å®šä¹‰ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿé¡ºåˆ©åœ°ä½¿ç”¨å’Œæ‰©å±•YOLOv8ç®—æ³•ã€‚

#### 11.4 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\hub\session.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å¹¶æ·»åŠ è¯¦ç»†ä¸­æ–‡æ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import signal
import sys
from time import sleep
import requests
from ultralytics.hub.utils import HUB_API_ROOT, HUB_WEB_ROOT, smart_request
from ultralytics.utils import LOGGER, __version__, checks, is_colab
from ultralytics.utils.errors import HUBModelError

AGENT_NAME = f'python-{__version__}-colab' if is_colab() else f'python-{__version__}-local'

class HUBTrainingSession:
    """
    Ultralytics HUB YOLOæ¨¡å‹çš„è®­ç»ƒä¼šè¯ç±»ã€‚å¤„ç†æ¨¡å‹åˆå§‹åŒ–ã€å¿ƒè·³å’Œæ£€æŸ¥ç‚¹ä¸Šä¼ ã€‚
    """

    def __init__(self, url):
        """
        åˆå§‹åŒ–HUBTrainingSessionï¼Œä½¿ç”¨æä¾›çš„æ¨¡å‹æ ‡è¯†ç¬¦ã€‚

        å‚æ•°:
            url (str): ç”¨äºåˆå§‹åŒ–HUBè®­ç»ƒä¼šè¯çš„æ¨¡å‹æ ‡è¯†ç¬¦ã€‚
        """
        from ultralytics.hub.auth import Auth

        # è§£æè¾“å…¥çš„æ¨¡å‹URL
        if url.startswith(f'{HUB_WEB_ROOT}/models/'):
            url = url.split(f'{HUB_WEB_ROOT}/models/')[-1]
        if [len(x) for x in url.split('_')] == [42, 20]:
            key, model_id = url.split('_')
        elif len(url) == 20:
            key, model_id = '', url
        else:
            raise HUBModelError(f"æ¨¡å‹='{url}'æœªæ‰¾åˆ°ã€‚è¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚")

        # æˆæƒ
        auth = Auth(key)
        self.model_id = model_id
        self.model_url = f'{HUB_WEB_ROOT}/models/{model_id}'
        self.api_url = f'{HUB_API_ROOT}/v1/models/{model_id}'
        self.auth_header = auth.get_auth_header()
        self.alive = True
        self._start_heartbeat()  # å¯åŠ¨å¿ƒè·³
        self._register_signal_handlers()  # æ³¨å†Œä¿¡å·å¤„ç†å™¨
        LOGGER.info(f'æŸ¥çœ‹æ¨¡å‹åœ¨ {self.model_url} ğŸš€')

    def _register_signal_handlers(self):
        """æ³¨å†Œä¿¡å·å¤„ç†å™¨ä»¥ä¼˜é›…åœ°å¤„ç†ç»ˆæ­¢ä¿¡å·ã€‚"""
        signal.signal(signal.SIGTERM, self._handle_signal)
        signal.signal(signal.SIGINT, self._handle_signal)

    def _handle_signal(self, signum, frame):
        """
        å¤„ç†ç»ˆæ­¢ä¿¡å·ï¼Œåœæ­¢å¿ƒè·³å¹¶é€€å‡ºç¨‹åºã€‚
        """
        if self.alive:
            LOGGER.info('æ”¶åˆ°ç»ˆæ­¢ä¿¡å·! âŒ')
            self._stop_heartbeat()
            sys.exit(signum)

    def _stop_heartbeat(self):
        """ç»ˆæ­¢å¿ƒè·³å¾ªç¯ã€‚"""
        self.alive = False

    def upload_metrics(self):
        """ä¸Šä¼ æ¨¡å‹çš„æŒ‡æ ‡åˆ°Ultralytics HUBã€‚"""
        payload = {'metrics': {}, 'type': 'metrics'}  # è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æŒ‡æ ‡æ•°æ®
        smart_request('post', self.api_url, json=payload, headers=self.auth_header)

    def _get_model(self):
        """ä»Ultralytics HUBè·å–å¹¶è¿”å›æ¨¡å‹æ•°æ®ã€‚"""
        api_url = f'{HUB_API_ROOT}/v1/models/{self.model_id}'
        try:
            response = smart_request('get', api_url, headers=self.auth_header)
            data = response.json().get('data', None)
            return data
        except requests.exceptions.ConnectionError:
            raise ConnectionRefusedError('é”™è¯¯: HUBæœåŠ¡å™¨æœªåœ¨çº¿ï¼Œè¯·ç¨åå†è¯•ã€‚')

    @threaded
    def _start_heartbeat(self):
        """å¼€å§‹ä¸€ä¸ªçº¿ç¨‹å¿ƒè·³å¾ªç¯ï¼Œå‘Ultralytics HUBæŠ¥å‘Šä»£ç†çŠ¶æ€ã€‚"""
        while self.alive:
            smart_request('post',
                          f'{HUB_API_ROOT}/v1/agent/heartbeat/models/{self.model_id}',
                          json={'agent': AGENT_NAME},
                          headers=self.auth_header)
            sleep(300)  # æ¯300ç§’å‘é€ä¸€æ¬¡å¿ƒè·³
```

### ä»£ç è¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼šå¯¼å…¥å¿…è¦çš„æ¨¡å—å’Œå‡½æ•°ï¼ŒåŒ…æ‹¬ä¿¡å·å¤„ç†ã€HTTPè¯·æ±‚å’ŒUltralyticsç›¸å…³çš„å·¥å…·ã€‚
2. **AGENT_NAME**ï¼šæ ¹æ®è¿è¡Œç¯å¢ƒï¼ˆColabæˆ–æœ¬åœ°ï¼‰è®¾ç½®ä»£ç†åç§°ã€‚
3. **HUBTrainingSessionç±»**ï¼šå®šä¹‰äº†ä¸€ä¸ªç±»ï¼Œç”¨äºç®¡ç†ä¸Ultralytics HUBçš„è®­ç»ƒä¼šè¯ã€‚
   - **`__init__`æ–¹æ³•**ï¼šåˆå§‹åŒ–ä¼šè¯ï¼Œè§£ææ¨¡å‹URLï¼Œè¿›è¡Œæˆæƒï¼Œå¹¶å¯åŠ¨å¿ƒè·³æœºåˆ¶ã€‚
   - **ä¿¡å·å¤„ç†**ï¼šæ³¨å†Œä¿¡å·å¤„ç†å™¨ä»¥ä¼˜é›…åœ°å¤„ç†ç¨‹åºç»ˆæ­¢ã€‚
   - **ä¸Šä¼ æŒ‡æ ‡**ï¼šå®šä¹‰ä¸Šä¼ æ¨¡å‹æŒ‡æ ‡çš„æ–¹æ³•ã€‚
   - **è·å–æ¨¡å‹**ï¼šä»HUBè·å–æ¨¡å‹æ•°æ®çš„æ–¹æ³•ã€‚
   - **å¿ƒè·³æœºåˆ¶**ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å®šæœŸå‘HUBå‘é€å¿ƒè·³ä»¥æŠ¥å‘ŠçŠ¶æ€ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯ä¸€ä¸ªç”¨äºUltralytics HUBçš„YOLOæ¨¡å‹è®­ç»ƒä¼šè¯ç®¡ç†çš„Pythonç±»ï¼Œåä¸º`HUBTrainingSession`ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯å¤„ç†æ¨¡å‹çš„åˆå§‹åŒ–ã€å¿ƒè·³æ£€æµ‹å’Œæ£€æŸ¥ç‚¹ä¸Šä¼ ç­‰æ“ä½œã€‚

åœ¨åˆå§‹åŒ–æ—¶ï¼Œæ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªæ¨¡å‹æ ‡è¯†ç¬¦ï¼ˆURLæˆ–ç‰¹å®šæ ¼å¼çš„æ¨¡å‹é”®ï¼‰ï¼Œå¹¶è§£æè¯¥æ ‡è¯†ç¬¦ä»¥è·å–æ¨¡å‹çš„å…³é”®éƒ¨åˆ†ã€‚å¦‚æœè¾“å…¥çš„æ¨¡å‹æ ‡è¯†ç¬¦æ ¼å¼ä¸æ­£ç¡®ï¼Œç¨‹åºä¼šæŠ›å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„`HUBModelError`å¼‚å¸¸ã€‚æ¥ç€ï¼Œç¨‹åºä¼šé€šè¿‡èº«ä»½éªŒè¯æ¨¡å—`Auth`æ¥ç”Ÿæˆèº«ä»½éªŒè¯å¤´ï¼Œå¹¶è®¾ç½®ä¸Ultralytics HUBç›¸å…³çš„å¤šä¸ªå±æ€§ï¼ŒåŒ…æ‹¬æ¨¡å‹çš„URLã€API URLã€é€Ÿç‡é™åˆ¶ç­‰ã€‚

ç¨‹åºä¸­å®šä¹‰äº†å¤šä¸ªæ–¹æ³•ã€‚`_register_signal_handlers`æ–¹æ³•ç”¨äºæ³¨å†Œä¿¡å·å¤„ç†ç¨‹åºï¼Œä»¥ä¾¿åœ¨æ¥æ”¶åˆ°ç»ˆæ­¢ä¿¡å·æ—¶èƒ½å¤Ÿä¼˜é›…åœ°åœæ­¢å¿ƒè·³æ£€æµ‹ã€‚`_handle_signal`æ–¹æ³•åˆ™å¤„ç†è¿™äº›ä¿¡å·ï¼Œç¡®ä¿åœ¨Colabç¯å¢ƒä¸­ç»ˆæ­¢åä¸ä¼šç»§ç»­å‘é€å¿ƒè·³ã€‚`_stop_heartbeat`æ–¹æ³•ç”¨äºåœæ­¢å¿ƒè·³å¾ªç¯ã€‚

`upload_metrics`æ–¹æ³•ç”¨äºå°†æ¨¡å‹çš„æŒ‡æ ‡ä¸Šä¼ åˆ°Ultralytics HUBã€‚`_get_model`æ–¹æ³•åˆ™è´Ÿè´£ä»Ultralytics HUBè·å–æ¨¡å‹æ•°æ®ï¼Œå¹¶æ ¹æ®æ¨¡å‹çš„çŠ¶æ€ï¼ˆå¦‚æ–°æ¨¡å‹ã€æ­£åœ¨è®­ç»ƒçš„æ¨¡å‹ç­‰ï¼‰è®¾ç½®è®­ç»ƒå‚æ•°ã€‚

æ­¤å¤–ï¼Œ`upload_model`æ–¹æ³•ç”¨äºå°†æ¨¡å‹çš„æ£€æŸ¥ç‚¹ä¸Šä¼ åˆ°Ultralytics HUBï¼Œæ”¯æŒä¸Šä¼ å½“å‰è®­ç»ƒçš„æƒé‡æ–‡ä»¶ï¼Œå¹¶å¯ä»¥æ ‡è®°å½“å‰æ¨¡å‹æ˜¯å¦æ˜¯æœ€ä½³æ¨¡å‹æˆ–æœ€ç»ˆæ¨¡å‹ã€‚

æœ€åï¼Œ`_start_heartbeat`æ–¹æ³•æ˜¯ä¸€ä¸ªçº¿ç¨‹åŒ–çš„å¿ƒè·³å¾ªç¯ï¼Œç”¨äºå®šæœŸå‘Ultralytics HUBæŠ¥å‘Šä»£ç†çš„çŠ¶æ€ã€‚å®ƒä¼šåœ¨å¾ªç¯ä¸­å‘é€è¯·æ±‚ï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚åæ ¹æ®è®¾å®šçš„é€Ÿç‡é™åˆ¶è¿›è¡Œç¡çœ ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªç±»çš„è®¾è®¡æ—¨åœ¨ç®€åŒ–ä¸Ultralytics HUBçš„äº¤äº’ï¼Œç¡®ä¿æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ•°æ®èƒ½å¤ŸåŠæ—¶ä¸Šä¼ å’Œç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤„ç†å¯èƒ½å‡ºç°çš„å¼‚å¸¸æƒ…å†µã€‚

#### 11.5 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\sam\modules\encoders.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œä¸»è¦é›†ä¸­åœ¨ `ImageEncoderViT` ç±»åŠå…¶ç›¸å…³çš„åµŒå…¥å’Œæ³¨æ„åŠ›æœºåˆ¶ã€‚

```python
import torch
import torch.nn as nn
from typing import Optional, Tuple, Type

class ImageEncoderViT(nn.Module):
    """
    ä½¿ç”¨è§†è§‰å˜æ¢å™¨ï¼ˆViTï¼‰æ¶æ„çš„å›¾åƒç¼–ç å™¨ï¼Œå°†å›¾åƒç¼–ç ä¸ºç´§å‡‘çš„æ½œåœ¨ç©ºé—´ã€‚
    è¯¥ç¼–ç å™¨å°†å›¾åƒåˆ†å‰²ä¸ºå¤šä¸ªå°å—ï¼Œå¹¶é€šè¿‡ä¸€ç³»åˆ—å˜æ¢å—å¤„ç†è¿™äº›å°å—ã€‚
    æœ€ç»ˆç¼–ç çš„è¡¨ç¤ºé€šè¿‡ä¸€ä¸ªé¢ˆéƒ¨æ¨¡å—ç”Ÿæˆã€‚
    """

    def __init__(
            self,
            img_size: int = 1024,  # è¾“å…¥å›¾åƒçš„å°ºå¯¸
            patch_size: int = 16,   # æ¯ä¸ªå°å—çš„å°ºå¯¸
            in_chans: int = 3,      # è¾“å…¥å›¾åƒçš„é€šé“æ•°
            embed_dim: int = 768,   # å°å—åµŒå…¥çš„ç»´åº¦
            depth: int = 12,        # ViTçš„æ·±åº¦ï¼ˆå˜æ¢å—çš„æ•°é‡ï¼‰
            num_heads: int = 12,    # æ¯ä¸ªå˜æ¢å—ä¸­çš„æ³¨æ„åŠ›å¤´æ•°é‡
            out_chans: int = 256,    # è¾“å‡ºé€šé“æ•°
            norm_layer: Type[nn.Module] = nn.LayerNorm,  # å½’ä¸€åŒ–å±‚
            act_layer: Type[nn.Module] = nn.GELU,         # æ¿€æ´»å±‚
    ) -> None:
        """
        åˆå§‹åŒ–å›¾åƒç¼–ç å™¨çš„å‚æ•°ã€‚
        """
        super().__init__()
        self.img_size = img_size

        # åˆå§‹åŒ–å°å—åµŒå…¥æ¨¡å—
        self.patch_embed = PatchEmbed(
            kernel_size=(patch_size, patch_size),
            stride=(patch_size, patch_size),
            in_chans=in_chans,
            embed_dim=embed_dim,
        )

        # åˆ›å»ºå˜æ¢å—åˆ—è¡¨
        self.blocks = nn.ModuleList()
        for _ in range(depth):
            block = Block(
                dim=embed_dim,
                num_heads=num_heads,
                norm_layer=norm_layer,
                act_layer=act_layer,
            )
            self.blocks.append(block)

        # é¢ˆéƒ¨æ¨¡å—ï¼Œè¿›ä¸€æ­¥å¤„ç†è¾“å‡º
        self.neck = nn.Sequential(
            nn.Conv2d(embed_dim, out_chans, kernel_size=1, bias=False),
            nn.LayerNorm(out_chans),
            nn.Conv2d(out_chans, out_chans, kernel_size=3, padding=1, bias=False),
            nn.LayerNorm(out_chans),
        )

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """
        å¤„ç†è¾“å…¥å›¾åƒï¼Œé€šè¿‡å°å—åµŒå…¥ã€å˜æ¢å—å’Œé¢ˆéƒ¨æ¨¡å—ç”Ÿæˆæœ€ç»ˆçš„ç¼–ç è¡¨ç¤ºã€‚
        """
        x = self.patch_embed(x)  # å°†å›¾åƒåˆ†å‰²ä¸ºå°å—å¹¶åµŒå…¥
        for blk in self.blocks:   # é€šè¿‡æ¯ä¸ªå˜æ¢å—å¤„ç†
            x = blk(x)
        return self.neck(x.permute(0, 3, 1, 2))  # è°ƒæ•´ç»´åº¦å¹¶é€šè¿‡é¢ˆéƒ¨æ¨¡å—

class PatchEmbed(nn.Module):
    """å›¾åƒåˆ°å°å—åµŒå…¥çš„æ¨¡å—ã€‚"""

    def __init__(
            self,
            kernel_size: Tuple[int, int] = (16, 16),
            stride: Tuple[int, int] = (16, 16),
            in_chans: int = 3,
            embed_dim: int = 768,
    ) -> None:
        """
        åˆå§‹åŒ–å°å—åµŒå…¥æ¨¡å—ã€‚
        """
        super().__init__()
        self.proj = nn.Conv2d(in_chans, embed_dim, kernel_size=kernel_size, stride=stride)

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """é€šè¿‡å·ç§¯è®¡ç®—å°å—åµŒå…¥å¹¶è°ƒæ•´è¾“å‡ºçš„ç»´åº¦ã€‚"""
        return self.proj(x).permute(0, 2, 3, 1)  # B C H W -> B H W C

class Block(nn.Module):
    """å˜æ¢å—ï¼ŒåŒ…å«æ³¨æ„åŠ›æœºåˆ¶å’Œå‰é¦ˆç½‘ç»œã€‚"""

    def __init__(
        self,
        dim: int,
        num_heads: int,
        norm_layer: Type[nn.Module] = nn.LayerNorm,
        act_layer: Type[nn.Module] = nn.GELU,
    ) -> None:
        """
        åˆå§‹åŒ–å˜æ¢å—çš„å‚æ•°ã€‚
        """
        super().__init__()
        self.norm1 = norm_layer(dim)  # å½’ä¸€åŒ–å±‚
        self.attn = Attention(dim, num_heads)  # æ³¨æ„åŠ›æœºåˆ¶
        self.norm2 = norm_layer(dim)  # ç¬¬äºŒä¸ªå½’ä¸€åŒ–å±‚
        self.mlp = MLPBlock(embedding_dim=dim, mlp_dim=int(dim * 4), act=act_layer)  # å‰é¦ˆç½‘ç»œ

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """æ‰§è¡Œå˜æ¢å—çš„å‰å‘ä¼ æ’­ã€‚"""
        shortcut = x
        x = self.norm1(x)  # å½’ä¸€åŒ–
        x = self.attn(x)   # æ³¨æ„åŠ›æœºåˆ¶
        x = shortcut + x   # æ®‹å·®è¿æ¥
        return x + self.mlp(self.norm2(x))  # å†æ¬¡å½’ä¸€åŒ–å¹¶é€šè¿‡å‰é¦ˆç½‘ç»œ

class Attention(nn.Module):
    """å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ã€‚"""

    def __init__(
        self,
        dim: int,
        num_heads: int = 8,
    ) -> None:
        """
        åˆå§‹åŒ–æ³¨æ„åŠ›æ¨¡å—ã€‚
        """
        super().__init__()
        self.num_heads = num_heads
        head_dim = dim // num_heads
        self.scale = head_dim ** -0.5  # ç¼©æ”¾å› å­

        self.qkv = nn.Linear(dim, dim * 3)  # æŸ¥è¯¢ã€é”®ã€å€¼çš„çº¿æ€§å˜æ¢
        self.proj = nn.Linear(dim, dim)  # è¾“å‡ºçº¿æ€§å˜æ¢

    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """æ‰§è¡Œæ³¨æ„åŠ›æœºåˆ¶çš„å‰å‘ä¼ æ’­ã€‚"""
        B, H, W, _ = x.shape
        qkv = self.qkv(x).reshape(B, H * W, 3, self.num_heads, -1).permute(2, 0, 3, 1, 4)
        q, k, v = qkv.reshape(3, B * self.num_heads, H * W, -1).unbind(0)

        attn = (q * self.scale) @ k.transpose(-2, -1)  # è®¡ç®—æ³¨æ„åŠ›æƒé‡
        attn = attn.softmax(dim=-1)  # å½’ä¸€åŒ–
        x = (attn @ v).view(B, self.num_heads, H, W, -1).permute(0, 2, 3, 1, 4).reshape(B, H, W, -1)
        return self.proj(x)  # é€šè¿‡çº¿æ€§å˜æ¢è¾“å‡º
```

### ä»£ç è¯´æ˜
1. **ImageEncoderViT**: ä¸»è¦ç±»ï¼Œè´Ÿè´£å°†è¾“å…¥å›¾åƒç¼–ç ä¸ºæ½œåœ¨ç©ºé—´è¡¨ç¤ºã€‚å®ƒåŒ…å«å°å—åµŒå…¥ã€å¤šä¸ªå˜æ¢å—å’Œä¸€ä¸ªé¢ˆéƒ¨æ¨¡å—ã€‚
2. **PatchEmbed**: å°†è¾“å…¥å›¾åƒåˆ†å‰²ä¸ºå°å—å¹¶è¿›è¡ŒåµŒå…¥çš„æ¨¡å—ã€‚
3. **Block**: å˜æ¢å—ï¼ŒåŒ…å«å½’ä¸€åŒ–ã€æ³¨æ„åŠ›æœºåˆ¶å’Œå‰é¦ˆç½‘ç»œã€‚
4. **Attention**: å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ï¼Œè´Ÿè´£è®¡ç®—æŸ¥è¯¢ã€é”®ã€å€¼ä¹‹é—´çš„å…³ç³»ã€‚

ä»¥ä¸Šä»£ç å®ç°äº†å›¾åƒç¼–ç çš„åŸºæœ¬ç»“æ„ï¼Œä½¿ç”¨äº†ç°ä»£æ·±åº¦å­¦ä¹ ä¸­çš„ä¸€äº›å…³é”®æŠ€æœ¯ï¼Œå¦‚å˜æ¢å™¨å’Œæ³¨æ„åŠ›æœºåˆ¶ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªå›¾åƒç¼–ç å™¨å’Œä¸€ä¸ªæç¤ºç¼–ç å™¨ï¼Œä¸»è¦ç”¨äºYOLOv8ç®—æ³•ä¸­çš„å›¾åƒå¤„ç†å’Œç‰¹å¾æå–ã€‚æ–‡ä»¶ä¸­ä½¿ç”¨äº†PyTorchæ¡†æ¶ï¼ŒåŒ…å«å¤šä¸ªç±»å’Œå‡½æ•°ï¼Œå…·ä½“åŠŸèƒ½å¦‚ä¸‹ï¼š

é¦–å…ˆï¼Œ`ImageEncoderViT`ç±»å®ç°äº†ä¸€ä¸ªåŸºäºè§†è§‰å˜æ¢å™¨ï¼ˆViTï¼‰æ¶æ„çš„å›¾åƒç¼–ç å™¨ã€‚è¯¥ç¼–ç å™¨çš„ä½œç”¨æ˜¯å°†è¾“å…¥å›¾åƒç¼–ç ä¸ºä¸€ä¸ªç´§å‡‘çš„æ½œåœ¨ç©ºé—´è¡¨ç¤ºã€‚å…¶å·¥ä½œæµç¨‹åŒ…æ‹¬å°†å›¾åƒåˆ†å‰²æˆå¤šä¸ªå°å—ï¼ˆpatchesï¼‰ï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—çš„å˜æ¢å—ï¼ˆtransformer blocksï¼‰å¤„ç†è¿™äº›å°å—ã€‚ç¼–ç åçš„å°å—éšåé€šè¿‡ä¸€ä¸ªâ€œneckâ€æ¨¡å—è¿›ä¸€æ­¥å¤„ç†ï¼Œä»¥ç”Ÿæˆæœ€ç»ˆçš„ç¼–ç è¡¨ç¤ºã€‚è¯¥ç±»çš„æ„é€ å‡½æ•°æ¥å—å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬è¾“å…¥å›¾åƒçš„å¤§å°ã€patchçš„å¤§å°ã€åµŒå…¥ç»´åº¦ã€å˜æ¢å—çš„æ·±åº¦ç­‰ï¼Œåˆå§‹åŒ–äº†å¿…è¦çš„å±‚å’Œæ¨¡å—ã€‚

åœ¨`forward`æ–¹æ³•ä¸­ï¼Œè¾“å…¥å›¾åƒé¦–å…ˆç»è¿‡patchåµŒå…¥å±‚ï¼Œç„¶åå¦‚æœå­˜åœ¨ä½ç½®åµŒå…¥ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°è¾“å‡ºä¸­ã€‚æ¥ç€ï¼Œç»è¿‡æ‰€æœ‰çš„å˜æ¢å—å¤„ç†ï¼Œæœ€åé€šè¿‡neckæ¨¡å—è¾“å‡ºç»“æœã€‚

æ¥ä¸‹æ¥æ˜¯`PromptEncoder`ç±»ï¼Œå®ƒç”¨äºç¼–ç ä¸åŒç±»å‹çš„æç¤ºï¼ŒåŒ…æ‹¬ç‚¹ã€æ¡†å’Œæ©ç ï¼Œä»¥ä¾¿è¾“å…¥åˆ°æ©ç è§£ç å™¨ä¸­ã€‚è¯¥ç±»èƒ½å¤Ÿç”Ÿæˆç¨€ç–å’Œå¯†é›†çš„åµŒå…¥è¡¨ç¤ºã€‚æ„é€ å‡½æ•°ä¸­å®šä¹‰äº†å¤šä¸ªå±æ€§ï¼Œå¦‚åµŒå…¥ç»´åº¦ã€è¾“å…¥å›¾åƒå¤§å°ã€æ©ç è¾“å…¥å¤§å°ç­‰ï¼Œå¹¶åˆå§‹åŒ–äº†ç›¸åº”çš„åµŒå…¥å±‚å’Œç½‘ç»œç»“æ„ã€‚

åœ¨`forward`æ–¹æ³•ä¸­ï¼Œè¯¥ç±»æ ¹æ®è¾“å…¥çš„ç‚¹ã€æ¡†å’Œæ©ç ç”Ÿæˆç›¸åº”çš„åµŒå…¥ã€‚å®ƒä¼šè°ƒç”¨å†…éƒ¨çš„ç§æœ‰æ–¹æ³•æ¥å¤„ç†ä¸åŒç±»å‹çš„è¾“å…¥ï¼Œå¹¶è¿”å›ç¨€ç–å’Œå¯†é›†çš„åµŒå…¥è¡¨ç¤ºã€‚

æ­¤å¤–ï¼Œæ–‡ä»¶ä¸­è¿˜å®šä¹‰äº†å¤šä¸ªè¾…åŠ©ç±»å’Œå‡½æ•°ï¼Œå¦‚`PositionEmbeddingRandom`ç”¨äºç”Ÿæˆéšæœºä½ç½®ç¼–ç ï¼Œ`Block`å’Œ`Attention`ç±»å®ç°äº†å˜æ¢å™¨çš„åŸºæœ¬ç»“æ„å’Œå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ï¼Œ`PatchEmbed`ç±»åˆ™è´Ÿè´£å°†å›¾åƒè½¬æ¢ä¸ºpatchåµŒå…¥ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡è§†è§‰å˜æ¢å™¨å¯¹å›¾åƒè¿›è¡Œç¼–ç ï¼Œå¹¶ä¸ºåç»­çš„ä»»åŠ¡ï¼ˆå¦‚ç›®æ ‡æ£€æµ‹æˆ–åˆ†å‰²ï¼‰æä¾›å¿…è¦çš„ç‰¹å¾è¡¨ç¤ºã€‚å®ƒå±•ç¤ºäº†ç°ä»£æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­å¦‚ä½•åˆ©ç”¨å˜æ¢å™¨æ¶æ„å¤„ç†å›¾åƒæ•°æ®ï¼Œå¹¶æœ‰æ•ˆåœ°æå–ç‰¹å¾ã€‚

#### 11.6 train.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
class DetectionTrainer(BaseTrainer):
    """
    DetectionTrainerç±»ç”¨äºåŸºäºæ£€æµ‹æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œç»§æ‰¿è‡ªBaseTrainerç±»ã€‚
    """

    def build_dataset(self, img_path, mode="train", batch=None):
        """
        æ„å»ºYOLOæ•°æ®é›†ã€‚

        å‚æ•°:
            img_path (str): åŒ…å«å›¾åƒçš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚
            mode (str): æ¨¡å¼ï¼Œ`train`è¡¨ç¤ºè®­ç»ƒæ¨¡å¼ï¼Œ`val`è¡¨ç¤ºéªŒè¯æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥ä¸ºæ¯ç§æ¨¡å¼è‡ªå®šä¹‰ä¸åŒçš„æ•°æ®å¢å¼ºã€‚
            batch (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œä»…åœ¨`rect`æ¨¡å¼ä¸‹ä½¿ç”¨ã€‚é»˜è®¤ä¸ºNoneã€‚
        """
        gs = max(int(de_parallel(self.model).stride.max() if self.model else 0), 32)  # è·å–æ¨¡å‹çš„æœ€å¤§æ­¥å¹…
        return build_yolo_dataset(self.args, img_path, batch, self.data, mode=mode, rect=mode == "val", stride=gs)

    def get_dataloader(self, dataset_path, batch_size=16, rank=0, mode="train"):
        """æ„é€ å¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚"""
        assert mode in ["train", "val"]  # ç¡®ä¿æ¨¡å¼æ˜¯è®­ç»ƒæˆ–éªŒè¯
        with torch_distributed_zero_first(rank):  # å¦‚æœä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œï¼Œç¡®ä¿æ•°æ®é›†åªåˆå§‹åŒ–ä¸€æ¬¡
            dataset = self.build_dataset(dataset_path, mode, batch_size)  # æ„å»ºæ•°æ®é›†
        shuffle = mode == "train"  # è®­ç»ƒæ¨¡å¼ä¸‹æ‰“ä¹±æ•°æ®
        if getattr(dataset, "rect", False) and shuffle:
            LOGGER.warning("WARNING âš ï¸ 'rect=True'ä¸DataLoaderçš„shuffleä¸å…¼å®¹ï¼Œè®¾ç½®shuffle=False")
            shuffle = False  # å¦‚æœä½¿ç”¨rectæ¨¡å¼ï¼Œç¦ç”¨æ‰“ä¹±
        workers = self.args.workers if mode == "train" else self.args.workers * 2  # è®¾ç½®å·¥ä½œçº¿ç¨‹æ•°
        return build_dataloader(dataset, batch_size, workers, shuffle, rank)  # è¿”å›æ•°æ®åŠ è½½å™¨

    def preprocess_batch(self, batch):
        """å¯¹ä¸€æ‰¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚"""
        batch["img"] = batch["img"].to(self.device, non_blocking=True).float() / 255  # å°†å›¾åƒè½¬ç§»åˆ°è®¾å¤‡å¹¶å½’ä¸€åŒ–
        if self.args.multi_scale:  # å¦‚æœå¯ç”¨å¤šå°ºåº¦è®­ç»ƒ
            imgs = batch["img"]
            sz = (
                random.randrange(self.args.imgsz * 0.5, self.args.imgsz * 1.5 + self.stride)
                // self.stride
                * self.stride
            )  # éšæœºé€‰æ‹©ä¸€ä¸ªå°ºå¯¸
            sf = sz / max(imgs.shape[2:])  # è®¡ç®—ç¼©æ”¾å› å­
            if sf != 1:  # å¦‚æœç¼©æ”¾å› å­ä¸ä¸º1
                ns = [
                    math.ceil(x * sf / self.stride) * self.stride for x in imgs.shape[2:]
                ]  # è®¡ç®—æ–°çš„å½¢çŠ¶
                imgs = nn.functional.interpolate(imgs, size=ns, mode="bilinear", align_corners=False)  # è¿›è¡Œæ’å€¼ç¼©æ”¾
            batch["img"] = imgs  # æ›´æ–°æ‰¹æ¬¡å›¾åƒ
        return batch

    def get_model(self, cfg=None, weights=None, verbose=True):
        """è¿”å›ä¸€ä¸ªYOLOæ£€æµ‹æ¨¡å‹ã€‚"""
        model = DetectionModel(cfg, nc=self.data["nc"], verbose=verbose and RANK == -1)  # åˆ›å»ºæ£€æµ‹æ¨¡å‹
        if weights:
            model.load(weights)  # åŠ è½½æƒé‡
        return model

    def get_validator(self):
        """è¿”å›ç”¨äºYOLOæ¨¡å‹éªŒè¯çš„DetectionValidatorã€‚"""
        self.loss_names = "box_loss", "cls_loss", "dfl_loss"  # å®šä¹‰æŸå¤±åç§°
        return yolo.detect.DetectionValidator(
            self.test_loader, save_dir=self.save_dir, args=copy(self.args), _callbacks=self.callbacks
        )  # è¿”å›éªŒè¯å™¨

    def plot_training_samples(self, batch, ni):
        """ç»˜åˆ¶å¸¦æœ‰æ³¨é‡Šçš„è®­ç»ƒæ ·æœ¬ã€‚"""
        plot_images(
            images=batch["img"],
            batch_idx=batch["batch_idx"],
            cls=batch["cls"].squeeze(-1),
            bboxes=batch["bboxes"],
            paths=batch["im_file"],
            fname=self.save_dir / f"train_batch{ni}.jpg",
            on_plot=self.on_plot,
        )  # ç»˜åˆ¶å›¾åƒå¹¶ä¿å­˜

    def plot_metrics(self):
        """ä»CSVæ–‡ä»¶ä¸­ç»˜åˆ¶æŒ‡æ ‡ã€‚"""
        plot_results(file=self.csv, on_plot=self.on_plot)  # ä¿å­˜ç»“æœå›¾åƒ
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è§£é‡Šï¼š
1. **DetectionTrainerç±»**ï¼šç”¨äºè®­ç»ƒYOLOæ£€æµ‹æ¨¡å‹ï¼Œç»§æ‰¿è‡ªBaseTrainerï¼Œå°è£…äº†è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ•°æ®é›†æ„å»ºã€æ•°æ®åŠ è½½ã€æ¨¡å‹è·å–ã€æŸå¤±è®¡ç®—ç­‰åŠŸèƒ½ã€‚
2. **build_datasetæ–¹æ³•**ï¼šæ ¹æ®è¾“å…¥çš„å›¾åƒè·¯å¾„å’Œæ¨¡å¼æ„å»ºYOLOæ•°æ®é›†ï¼Œæ”¯æŒè®­ç»ƒå’ŒéªŒè¯æ¨¡å¼ã€‚
3. **get_dataloaderæ–¹æ³•**ï¼šæ„å»ºæ•°æ®åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½æ•°æ®å¹¶è¿›è¡Œå¿…è¦çš„é¢„å¤„ç†ã€‚
4. **preprocess_batchæ–¹æ³•**ï¼šå¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å½’ä¸€åŒ–å’Œå¤šå°ºåº¦è°ƒæ•´ã€‚
5. **get_modelæ–¹æ³•**ï¼šåˆ›å»ºå¹¶è¿”å›YOLOæ£€æµ‹æ¨¡å‹ï¼Œå¯ä»¥é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
6. **get_validatoræ–¹æ³•**ï¼šè¿”å›ç”¨äºæ¨¡å‹éªŒè¯çš„éªŒè¯å™¨ï¼ŒåŒ…å«æŸå¤±åç§°çš„å®šä¹‰ã€‚
7. **plot_training_sampleså’Œplot_metricsæ–¹æ³•**ï¼šç”¨äºå¯è§†åŒ–è®­ç»ƒæ ·æœ¬å’Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `train.py` æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒ YOLOï¼ˆYou Only Look Onceï¼‰ç›®æ ‡æ£€æµ‹æ¨¡å‹çš„å®ç°ï¼Œç»§æ‰¿è‡ª `BaseTrainer` ç±»ã€‚ç¨‹åºçš„ä¸»è¦åŠŸèƒ½æ˜¯æ„å»ºæ•°æ®é›†ã€åŠ è½½æ•°æ®ã€é¢„å¤„ç†å›¾åƒã€è®¾ç½®æ¨¡å‹å±æ€§ã€è·å–æ¨¡å‹ã€è¿›è¡ŒéªŒè¯ã€è®°å½•æŸå¤±ã€æ˜¾ç¤ºè®­ç»ƒè¿›åº¦ã€ç»˜åˆ¶è®­ç»ƒæ ·æœ¬å’Œç»˜åˆ¶è®­ç»ƒæŒ‡æ ‡ç­‰ã€‚

åœ¨æ–‡ä»¶å¼€å¤´ï¼Œå¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“å’Œæ¨¡å—ï¼ŒåŒ…æ‹¬æ•°å­¦è¿ç®—ã€éšæœºæ•°ç”Ÿæˆã€æ·±åº¦å­¦ä¹ ç›¸å…³çš„åº“ï¼ˆå¦‚ PyTorchï¼‰ï¼Œä»¥åŠ Ultralytics æä¾›çš„å„ç§å·¥å…·å’Œæ¨¡å‹ã€‚æ¥ä¸‹æ¥å®šä¹‰äº† `DetectionTrainer` ç±»ï¼Œè¿™ä¸ªç±»æ˜¯ä¸“é—¨ä¸ºç›®æ ‡æ£€æµ‹ä»»åŠ¡è®¾è®¡çš„ã€‚

`build_dataset` æ–¹æ³•ç”¨äºæ„å»º YOLO æ•°æ®é›†ï¼Œæ¥å—å›¾åƒè·¯å¾„ã€æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰å’Œæ‰¹é‡å¤§å°ä½œä¸ºå‚æ•°ã€‚æ ¹æ®æ¨¡å‹çš„æ­¥å¹…ï¼ˆstrideï¼‰æ¥å†³å®šæ•°æ®é›†çš„æ„å»ºæ–¹å¼ã€‚

`get_dataloader` æ–¹æ³•ç”¨äºæ„å»ºæ•°æ®åŠ è½½å™¨ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼è®­ç»ƒæ—¶åªåˆå§‹åŒ–ä¸€æ¬¡æ•°æ®é›†ã€‚æ ¹æ®æ¨¡å¼é€‰æ‹©æ˜¯å¦æ‰“ä¹±æ•°æ®ï¼Œå¹¶è®¾ç½®å·¥ä½œçº¿ç¨‹çš„æ•°é‡ã€‚

`preprocess_batch` æ–¹æ³•å¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å°†å›¾åƒç¼©æ”¾åˆ°åˆé€‚çš„å¤§å°å¹¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°æ ¼å¼ã€‚è¿™ä¸ªæ–¹æ³•è¿˜æ”¯æŒå¤šå°ºåº¦è®­ç»ƒï¼Œå³åœ¨æ¯ä¸ªè®­ç»ƒæ‰¹æ¬¡ä¸­éšæœºé€‰æ‹©å›¾åƒçš„å¤§å°ã€‚

`set_model_attributes` æ–¹æ³•ç”¨äºè®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œç±»åˆ«åç§°ç­‰ï¼Œä»¥ä¾¿æ¨¡å‹èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«è®­ç»ƒæ•°æ®ä¸­çš„ç›®æ ‡ã€‚

`get_model` æ–¹æ³•è¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹çš„å®ä¾‹ï¼Œå¦‚æœæä¾›äº†æƒé‡æ–‡ä»¶ï¼Œåˆ™åŠ è½½è¿™äº›æƒé‡ã€‚

`get_validator` æ–¹æ³•è¿”å›ä¸€ä¸ªç”¨äºéªŒè¯æ¨¡å‹æ€§èƒ½çš„éªŒè¯å™¨ï¼Œå¹¶å®šä¹‰äº†æŸå¤±åç§°ã€‚

`label_loss_items` æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªåŒ…å«è®­ç»ƒæŸå¤±é¡¹çš„å­—å…¸ï¼Œä¾¿äºè®°å½•å’Œç›‘æ§è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±æƒ…å†µã€‚

`progress_string` æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œæ˜¾ç¤ºè®­ç»ƒè¿›åº¦ï¼ŒåŒ…æ‹¬å½“å‰çš„ epochã€GPU å†…å­˜ä½¿ç”¨æƒ…å†µã€æŸå¤±å€¼ã€å®ä¾‹æ•°é‡å’Œå›¾åƒå¤§å°ç­‰ä¿¡æ¯ã€‚

`plot_training_samples` æ–¹æ³•ç”¨äºç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶æ³¨é‡Šï¼Œä¾¿äºå¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ•°æ®ã€‚

æœ€åï¼Œ`plot_metrics` å’Œ `plot_training_labels` æ–¹æ³•åˆ†åˆ«ç”¨äºç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡å’Œåˆ›å»ºå¸¦æ ‡ç­¾çš„è®­ç»ƒå›¾ï¼Œå¸®åŠ©åˆ†ææ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªç¨‹åºæ–‡ä»¶æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„è®­ç»ƒæ¡†æ¶ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†ç›®æ ‡æ£€æµ‹ä»»åŠ¡ï¼Œåˆ©ç”¨ YOLO æ¨¡å‹è¿›è¡Œè®­ç»ƒå’ŒéªŒè¯ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºYOLOv8ç®—æ³•çš„ç›®æ ‡æ£€æµ‹æ¡†æ¶ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå®Œæ•´çš„è®­ç»ƒã€éªŒè¯å’Œæ¨ç†æµç¨‹ã€‚æ•´ä½“æ¶æ„åŒ…æ‹¬å¤šä¸ªæ¨¡å—å’Œå·¥å…·ï¼Œæ”¯æŒå›¾åƒç¼–ç ã€æ•°æ®åŠ è½½ã€æ¨¡å‹è®­ç»ƒã€æ€§èƒ½è¯„ä¼°å’Œç»“æœå¯è§†åŒ–ã€‚ä¸»è¦åŠŸèƒ½æ¨¡å—åŒ…æ‹¬ï¼š

1. **æ•°æ®å¤„ç†**ï¼šè´Ÿè´£æ„å»ºå’Œé¢„å¤„ç†æ•°æ®é›†ï¼Œç¡®ä¿è¾“å…¥æ•°æ®çš„æ ¼å¼å’Œè´¨é‡ã€‚
2. **æ¨¡å‹æ„å»º**ï¼šå®ç°YOLOv8æ¨¡å‹çš„å„ä¸ªç»„ä»¶ï¼ŒåŒ…æ‹¬ç¼–ç å™¨ã€å¤´éƒ¨å’ŒæŸå¤±è®¡ç®—ç­‰ã€‚
3. **è®­ç»ƒå’ŒéªŒè¯**ï¼šæä¾›è®­ç»ƒè¿‡ç¨‹çš„ç®¡ç†ï¼ŒåŒ…æ‹¬æŸå¤±è®°å½•ã€è¿›åº¦æ˜¾ç¤ºå’Œæ¨¡å‹éªŒè¯ã€‚
4. **ç”¨æˆ·ç•Œé¢**ï¼šé€šè¿‡å‘½ä»¤è¡Œæˆ–å›¾å½¢ç•Œé¢æä¾›ç”¨æˆ·äº¤äº’åŠŸèƒ½ã€‚
5. **å·¥å…·å’Œå®ç”¨ç¨‹åº**ï¼šæä¾›å„ç§è¾…åŠ©åŠŸèƒ½ï¼Œå¦‚å›è°ƒã€ä¿¡å·å¤„ç†å’ŒçŠ¶æ€ç®¡ç†ã€‚

### æ–‡ä»¶åŠŸèƒ½æ•´ç†è¡¨

| æ–‡ä»¶è·¯å¾„                                                                                     | åŠŸèƒ½æè¿°                                                         |
|---------------------------------------------------------------------------------------------|------------------------------------------------------------------|
| `code\ultralytics\utils\tal.py`                                                            | å®ç°ä»»åŠ¡å¯¹é½åˆ†é…å™¨ï¼Œç”¨äºé”šæ¡†ä¸çœŸå®ç›®æ ‡çš„åŒ¹é…ï¼Œä¼˜åŒ–ç›®æ ‡æ£€æµ‹æ€§èƒ½ã€‚ |
| `ui.py`                                                                                     | é€šè¿‡å½“å‰Pythonç¯å¢ƒè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ï¼Œç®€åŒ–è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ã€‚             |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\sam\modules\__init__.py` | åˆå§‹åŒ–æ¨¡å—ï¼Œå®šä¹‰åŒ…ç»“æ„ã€‚                                         |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\hub\session.py`       | ç®¡ç†ä¸Ultralytics HUBçš„äº¤äº’ï¼Œå¤„ç†æ¨¡å‹è®­ç»ƒä¼šè¯å’ŒçŠ¶æ€ä¸Šä¼ ã€‚       |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\sam\modules\encoders.py` | å®ç°å›¾åƒç¼–ç å™¨å’Œæç¤ºç¼–ç å™¨ï¼Œæå–å›¾åƒç‰¹å¾ç”¨äºåç»­å¤„ç†ã€‚           |
| `train.py`                                                                                  | è´Ÿè´£YOLOæ¨¡å‹çš„è®­ç»ƒæµç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½ã€æ¨¡å‹æ„å»ºå’ŒæŸå¤±è®°å½•ã€‚     |
| `code\ultralytics\utils\callbacks\dvc.py`                                                  | æä¾›æ•°æ®ç‰ˆæœ¬æ§åˆ¶å’Œå›è°ƒåŠŸèƒ½ï¼Œæ”¯æŒè®­ç»ƒè¿‡ç¨‹ä¸­çš„çŠ¶æ€ç®¡ç†ã€‚           |
| `code\ultralytics\nn\modules\head.py`                                                      | å®ç°YOLOæ¨¡å‹çš„å¤´éƒ¨ç»“æ„ï¼Œè´Ÿè´£ç›®æ ‡æ£€æµ‹çš„è¾“å‡ºã€‚                     |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\yolo\model.py` | å®šä¹‰YOLOæ¨¡å‹çš„æ•´ä½“ç»“æ„ï¼ŒåŒ…æ‹¬ç½‘ç»œå±‚å’Œå‰å‘ä¼ æ’­é€»è¾‘ã€‚               |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\utils\__init__.py` | åˆå§‹åŒ–å·¥å…·æ¨¡å—ï¼Œæä¾›æ¨¡å‹è®­ç»ƒå’Œæ¨ç†æ‰€éœ€çš„è¾…åŠ©åŠŸèƒ½ã€‚               |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\yolo\segment\val.py` | å®ç°åˆ†å‰²ä»»åŠ¡çš„éªŒè¯é€»è¾‘ï¼Œè¯„ä¼°æ¨¡å‹åœ¨åˆ†å‰²ä»»åŠ¡ä¸Šçš„æ€§èƒ½ã€‚             |
| `code\ultralytics\trackers\utils\kalman_filter.py`                                         | å®ç°å¡å°”æ›¼æ»¤æ³¢å™¨ï¼Œç”¨äºç›®æ ‡è·Ÿè¸ªå’ŒçŠ¶æ€ä¼°è®¡ã€‚                       |

è¿™ä¸ªè¡¨æ ¼æ¦‚è¿°äº†æ¯ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œå¸®åŠ©ç†è§£æ•´ä¸ªé¡¹ç›®çš„ç»“æ„å’ŒåŠŸèƒ½æ¨¡å—ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ70+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/ZpuVlJ1q](https://mbd.pub/o/bread/ZpuVlJ1q)